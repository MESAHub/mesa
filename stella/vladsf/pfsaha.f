C---------------------------------------------------------------------------
C               S U B R O U T I N E   P F S A H A
C---------------------------------------------------------------------------
      SUBROUTINE PFSAHA(IZ, NION, MODE, T, P, XNE, ANSWER)
      IMPLICIT REAL*8 (A-H,O-Z)
C
      REAL*8 XNE, P, ANSWER(6)
C This is a slightly modified version of a routine written by Robert Kurucz.
C I use it to calculate ionization fraction, though as indicated below it
C will also return partition function. The routine contains data for all
C elements up to IZ=99. 
C
C Calling parameters: 
C  IZ is the nucleus charge.
C  NION specifies the ionization stage to calculate.
C
C     MODE 1 RETURNS IONIZATION FRACTION /PARTITION FUNCTION
C     MODE 2 RETURNS IONIZATION FRACTION
C     MODE 3 RETURNS PARTITION FUNCTION
C     MODE 4 RETURNS NUMBER OF ELECTRONS PRODUCED
C     MODE + 10 RETURN ALL IONS TO NION.   MODE ALONE RETURN NION ONLY.
C
C  XNE contains the electron density.
C  P must contain the total gas pressure.
      
      intent(in) IZ, NION, MODE, T, P, XNE
      intent(out) ANSWER
      DIMENSION F(6),IP(6),PART(6),POTLO(6),LOCZ(29)
      DIMENSION FSAVE(6)
      REAL*8 IP
      DIMENSION SCALE(4)
      DIMENSION EHYD(6),EHE1(29),EHE2(6),EC1(14),EMG1(11),EAL1(9),
     1ESI1(11),EC2(6),EMG2(6),ESI2(6),ECA1(8),ECA2(5),ENA1(8),
     2EO1(13),EB1(7),EK1(8)
      DIMENSION GHYD(6),GHE1(29),GHE2(6),GC1(14),GMG1(11),GAL1(9),
     1GSI1(11),GC2(6),GMG2(6),GSI2(6),GCA1(8),GCA2(5),GNA1(8),
     2GO1(13),GB1(7),GK1(8)
      DIMENSION NNNa(6*365)
      DIMENSION NNN(6,365)
      EQUIVALENCE (NNNa,NNN)
      DIMENSION NNN01(54),NNN02(54),NNN03(54),NNN04(54),NNN05(54)
      DIMENSION NNN06(54),NNN07(54),NNN08(54),NNN09(54),NNN10(54)
      DIMENSION NNN11(54),NNN12(54),NNN13(54),NNN14(54),NNN15(54)
      DIMENSION NNN16(54),NNN17(54),NNN18(54),NNN19(54),NNN20(54)
      DIMENSION NNN21(54),NNN22(54),NNN23(54),NNN24(54),NNN25(54)
      DIMENSION NNN26(54),NNN27(54),NNN28(54),NNN29(54),NNN30(54)
      DIMENSION NNN31(54),NNN32(54),NNN33(54),NNN34(54),NNN35(54)
      DIMENSION NNN36(54),NNN37(54),NNN38(54),NNN39(54),NNN40(12)
      EQUIVALENCE (NNNa(   1),NNN01(1)),(NNNa(  55),NNN02(1))
      EQUIVALENCE (NNNa( 109),NNN03(1)),(NNNa( 163),NNN04(1))
      EQUIVALENCE (NNNa( 217),NNN05(1)),(NNNa( 271),NNN06(1))
      EQUIVALENCE (NNNa( 325),NNN07(1)),(NNNa( 379),NNN08(1))
      EQUIVALENCE (NNNa( 433),NNN09(1)),(NNNa( 487),NNN10(1))
      EQUIVALENCE (NNNa( 541),NNN11(1)),(NNNa( 595),NNN12(1))
      EQUIVALENCE (NNNa( 649),NNN13(1)),(NNNa( 703),NNN14(1))
      EQUIVALENCE (NNNa( 757),NNN15(1)),(NNNa( 811),NNN16(1))
      EQUIVALENCE (NNNa( 865),NNN17(1)),(NNNa( 919),NNN18(1))
      EQUIVALENCE (NNNa( 973),NNN19(1)),(NNNa(1027),NNN20(1))
      EQUIVALENCE (NNNa(1081),NNN21(1)),(NNNa(1135),NNN22(1))
      EQUIVALENCE (NNNa(1189),NNN23(1)),(NNNa(1243),NNN24(1))
      EQUIVALENCE (NNNa(1297),NNN25(1)),(NNNa(1351),NNN26(1))
      EQUIVALENCE (NNNa(1405),NNN27(1)),(NNNa(1459),NNN28(1))
      EQUIVALENCE (NNNa(1513),NNN29(1)),(NNNa(1567),NNN30(1))
      EQUIVALENCE (NNNa(1621),NNN31(1)),(NNNa(1675),NNN32(1))
      EQUIVALENCE (NNNa(1729),NNN33(1)),(NNNa(1783),NNN34(1))
      EQUIVALENCE (NNNa(1837),NNN35(1)),(NNNa(1891),NNN36(1))
      EQUIVALENCE (NNNa(1945),NNN37(1)),(NNNa(1999),NNN38(1))
      EQUIVALENCE (NNNa(2053),NNN39(1)),(NNNa(2107),NNN40(1))
      DIMENSION NNN67(72)
      EQUIVALENCE (NNNa(2119),NNN67(1))
C      ( 1)( 2)   ( 3)( 4)   ( 5)( 6)   ( 7)( 8)   ( 9)(10)   ( IP ) G  REF
      DATA NNN01/
     1 200020001, 200020011, 201620881, 231228281, 378953411,  1359502,
     2 100010001, 100010001, 100010001, 100010001, 100010001,  1359500,
     3 100010001, 100010011, 102111241, 145022061, 363059451,  2458104,
     4 200020001, 200020071, 208524971, 382669341, 128222452,  5440302,
     5 100010001, 100010001, 100010001, 100010001, 100010001,  5440300,
     6 200020011, 201220481, 212922881, 258731081, 394251691,   538901,
     7 100010001, 100010201, 126225521,  67216512, 351165562,  7561907,
     8 200020001, 200020211, 227936571,  69610342, 137217102, 12241800,
     9 100010001, 100010001, 100010001, 100010001, 100010001, 12241800/
      DATA NNN02/
     1 100010051, 104311441, 131615641, 190623681, 298037691,   931900,
     2 200120231, 211422771, 249627631, 309034911, 398545051,  1820600,
     3 100010001, 100010201, 126225521,  67216512, 351165562, 15385000,
     4 200020001, 200020011, 201220661, 223426161, 332644691, 21765700,
     5 600060001, 600560281, 608761991, 637466191, 693973361,   829500,
     6 100310831, 132016901, 214226411, 315736741, 419147071,  2514900,
     7 200721061, 233526401, 297533311, 369040481, 440747651,  3792000,
     8 100010001, 100010001, 100010001, 100010001, 100010001, 25929800,
     9 893292271,  96110042, 105311262, 126315202, 196126432,  1125508/
      DATA NNN03/
     1 595060251, 620865751, 713280191,  95712292, 167623542,  2437501,
     2 105513201, 180324851, 341851341,  88416332, 296550722,  4787101,
     3 204922771, 262630421, 350941931, 494556971, 644872001,  6447600,
     4 403141851, 457051681, 594071181,  92913362, 203331152,  1452915,
     5 919899541, 107211512, 124914302, 182526232, 403762662,  2959202,
     6 596862721, 684177081,  88110342, 128317062, 239334312,  4742501,
     7 112816481, 240733751, 462068491, 116419932, 283736822,  7744900,
     8 210124681, 293634211, 391145791, 539862151, 703178471,  9786200,
     9 874789691, 924795711,  99410492, 115213492, 169022242,  1361307/
      DATA NNN04/
     1 424151091, 622874781,  91312832, 221842502,  79914013,  3510711,
     2  95610702, 118113032, 149619922, 329761642, 101914173,  5488500,
     3 603567171, 775391141, 106612482, 143716252, 181420032,  7739300,
     4 124420321, 306943181, 606281181, 101712232, 142916342, 11387300,
     5 215026541, 323137551, 421546491, 508255151, 594863811, 13807900,
     6 575958511, 589859231, 595860671, 636470031, 815199581,  1741802,
     7 900296401, 102610802, 113912542, 152921152, 318348952,  3498003,
     8 469162651, 791295541, 121419552, 402686872, 154822203,  6264500,
     9  99511422, 129214572, 170523002, 320140922, 498458762,  8713900/
      DATA NNN05/
     1 615472711,  87710602, 127215002, 172919582, 218624152, 11421300,
     2 135324181, 377252001, 661580261,  94410852, 122613672, 15711700,
     3 100010001, 100010051, 105313051, 210239461,  74013022,  2155808,
     4 580158751, 591759741, 642687101, 159332652,  64111533,  4106907,
     5  93510272, 110411662, 127116062, 257647882,  75110223,  6350000,
     6 529774371,  94611322, 135816202, 188221442, 240626682,  9701900,
     7 103312152, 140616092, 181320182, 222224262, 263128352, 12630000,
     8 629178711,  98311802, 136715512, 173619202, 210422892, 15790900,
     9 200020001, 200320211, 207322131, 253031421, 417657451,   513802/
      DATA NNN06/
     1 100010001, 100010161, 119621261,  50711872, 246445382,  4728901,
     2 580158751, 591860351,  71813142, 321968812, 106014333,  7165000,
     3  96910772, 116012242, 130714232, 153916552, 177118872,  9888000,
     4 601386081, 108812932, 148916832, 187820722, 226624612, 13836900,
     5 105712442, 144616652, 189221182, 234425702, 279630222, 17209000,
     6 100010011, 101410621, 118414581, 204831781, 509479731,   764404,
     7 200120051, 202921001, 226926901, 368457091,  92814872,  1503101,
     8 100010001, 100110611, 177455431, 176546012,  99718753,  8011905,
     9 579758751, 591459501, 600560591, 611461681, 622362781, 10928900/
      DATA NNN07/
     1 100611232, 120612752, 134214102, 147815462, 161416822, 14122900,
     2 674896701, 121814462, 167018942, 211723412, 256527892, 18648900,
     3 558857701, 583558761, 593260591, 635969541, 796790971,   598400,
     4 100310211, 110313021, 172828201,  55311252, 215637942,  1882203,
     5 200320201, 208622331, 250530971, 410251081, 611571211,  2844000,
     6 100010001, 100210881, 207436531, 523168101, 838999681, 11996000,
     7 577758651, 591259631, 604461351, 622563161, 640764981, 15377000,
     8 103511582, 124713242, 140014772, 155316292, 170517812, 19042000,
     9 825189211,  95210052, 106211532, 134317202, 237934082,   814913/
      DATA NNN08/
     1 563057761, 588160311, 631768671, 791097651, 127817282,  1634000,
     2 101110771, 126716471, 232438081,  71914052, 262045302,  3346001,
     3 200720521, 217224081, 284439171, 551370951,  86810262,  4513000,
     4 100010001, 100210881, 207436531, 523168101, 838999681, 16672900,
     5 575458521, 591459851, 610063201, 672674071, 843698661, 20510900,
     6 402643441, 496757481, 658274401, 833492941, 103511532,  1048300,
     7 874497931, 106011282, 119812802, 138415142, 164717802,  1972000,
     8 564058061, 604164611, 709579551,  90410172, 112912422,  3015500,
     9 100811411, 149720221, 280936121, 441552181, 602168241,  5135400/
      DATA NNN09/
     1 200420781, 227025361, 281430911, 336936471, 392542021,  6500700,
     2 100010001, 100010001, 100010001, 100010001, 100010001, 22041300,
     3 822887891, 930697831, 102610932, 121614492, 185124742,  1035708,
     4 443056011, 694982961,  96911522, 144218572, 227326892,  2339900,
     5  91610392, 113512242, 136416942, 233429882, 364242962,  3500000,
     6 560058861, 633871081,  82410062, 123314602, 168619132,  4728900,
     7 104512901, 177025421, 375163021, 122420462, 286036742,  7250000,
     8 202321571, 241428261, 358355061,  78310152, 124814802,  8802800,
     9 538155931, 571657911, 598067191,  89013782, 227737172,  1300916/
      DATA NNN10/
     1 873396771, 104411072, 118513532, 175525872, 406763932,  2379903,
     2 506569571,  87610522, 134421682, 439092662, 182132573,  3990006,
     3  95110872, 120013232, 154921252, 345149322, 641378942,  5350000,
     4 558960371, 677779341,  95311692, 138816082, 182720472,  6780000,
     5 100010001, 100010051, 106913911, 240147261,  90716112,  1575411,
     6 550256831, 578158781, 636585461, 151530162,  58010303,  2762007,
     7  92110362, 112412002, 133216772, 254443722,  76512833,  4090003,
     8 582082081, 103112292, 149920212, 309750502, 720793642,  5978900,
     9  97111072, 123213982, 172625622, 463976582, 106413633,  7500000/
      DATA NNN11/
     1 200020011, 200720361, 211923291, 280137141, 525575741,   433803,
     2 100010001, 100110341, 135929551,  79119282, 405274892,  3180905,
     3 554657081, 581260301,  73012702, 285363872, 129023363,  4600005,
     4  96010862, 118413212, 180836632,  90321023, 416863253,  6090000,
     5 657793361, 119515082, 195826322, 352944302, 533162332,  8259900,
     6 100110061, 104311741, 145919971, 294345051,  69010322,   611003,
     7 205822781, 279234761, 427553061, 688994901, 136319772,  1186701,
     8 100010001, 100510821, 168744821, 130232522,  69012813,  5121003,
     9 555157161, 585662471,  82816862,  42510013, 168423663,  6700000/
      DATA NNN12/
     1  99411262, 123814062, 182930402, 484766392,  84310223,  8438900,
     2 924696691, 105212282, 151219062, 240530032, 368944512,   653900,
     3 190424662, 297634542, 391743752, 482952832, 573761912,  1280000,
     4 976799291, 101110322, 105810882, 111911502, 118112122,  2475000,
     5 100010001, 100510821, 168744821, 130232522,  69012813,  7390000,
     6 555157161, 585662471,  82816862,  42510013, 168423663,  9200000,
     7 181021172, 260333222, 430155582, 710089242, 110213293,   681900,
     8 474659872, 721284672,  98211413, 134515623, 177919963,  1356900,
     9 228327012, 308134272, 381143862, 534563472, 734983512,  2747000/
      DATA NNN13/
     1 971498311,  99210032, 102610572, 108711172, 114711782,  4324000,
     2 100010001, 100510821, 168744821, 130232522,  69012813,  9980000,
     3 272835172, 425851532, 632278322,  97212013, 146817723,   674000,
     4 373954132, 743597002, 121414713, 173920143, 229225713,  1464900,
     5 323142642, 519660272, 679975352, 824789522,  96610363,  2930900,
     6 248329302, 324234952, 373439752, 421744582, 469949412,  4800000,
     7 970698231, 990699881, 100710152, 102410322, 104010482,  6500000,
     8 717277611,  92911652, 152620872, 295141952, 550468122,   676400,
     9  71611552, 205635512, 558281952, 115315823, 205625293,  1649000/
      DATA NNN14/
     1 280639822, 538369722,  87610823, 129115003, 170919183,  3095000,
     2 377150952, 616070292, 791788382,  97610683, 116012523,  5000000,
     3 264730962, 341436462, 394042872, 463549832, 533056782,  7300000,
     4 600060321, 629270891,  86911302, 151020222, 267534752,   743100,
     5 739594821, 139921212, 309342852, 567372412,  97112553,  1563600,
     6  98417472, 265535782, 454754842, 641973532, 828792212,  3369000,
     7 328847052, 586668342, 771785912,  94710343, 112112093,  5300000,
     8 422055132, 636770792, 779285062, 921999322, 106411363,  7600000,
     9 197023222, 274433302, 416753952, 723799822, 139419053,   787038/
      DATA NNN15/
     1 409453722, 686687452, 110213823, 174322233, 286437043,  1617902,
     2 262136422, 501167232,  87911303, 138916483, 190721673,  3064300,
     3  98723522, 420363072,  87011423, 145117913, 215925463,  5700000,
     4 388854482, 666275742, 846693572, 102511143, 120312923,  7900000,
     5 199427202, 335740022, 474957182, 708090462, 118315403,   786000,
     6 279739202, 490858232, 684582472, 104713233, 159818733,  1704900,
     7 279836622, 461857562, 720693022, 124915873, 192522633,  3349000,
     8 262136422, 501167232,  87911303, 138916483, 190821673,  5300000,
     9  98723522, 420363072,  87011423, 145117913, 215925463,  8300000/
      DATA NNN16/
     1 227027622, 306233052, 356839222, 446052912, 652382292,   763314,
     2 108416342, 222428472, 353944332, 577378932, 110314303,  1814900,
     3 198724282, 293236452, 468362702,  86511123, 136016073,  3516000,
     4 279836622, 461857562, 720693022, 124915873, 192522633,  5600000,
     5 262136422, 501167232,  87911303, 138916483, 190721673,  7900000,
     6 201620781, 231026761, 314737361, 450555381, 692386911,   772301,
     7 109415761, 247938311,  58910042, 190937022,  68311693,  2028903,
     8 897195961, 107212972, 165021182, 260230862, 356940532,  3682900,
     9 100010001, 100410231, 108712611, 167124841, 388460411,   939102/
      DATA NNN17/
     1 200020021, 201620761, 223726341, 351352061,  80812472,  1796001,
     2 100610471, 122617301, 300566361, 149924112, 332342352,  3970000,
     3 403245601, 493151431, 529654331, 559358091, 611065171,   600000,
     4  99710051, 104511541, 135016501, 208226431, 321837921,  2050900,
     5 199820071, 204521391, 229124761, 266028451, 302932131,  3070000,
     6 502665261, 755183501, 901496201, 102410942, 117912812,   787900,
     7 422848161, 512153401, 557458941, 636270361, 794489061,  1593000,
     8 100010261, 114613921, 175221251, 249828711, 324436181,  3421000,
     9 403143241, 491856701, 649173781, 840396751, 113013392,   981000/
      DATA NNN18/
     1 593676641, 884697521, 105911572, 129515012, 180322212,  1858700,
     2 484470541,  91510972, 125614082, 157017612, 199722912,  2829900,
     3 630172361, 799686381, 919797221, 102810942, 117712832,   975000,
     4 438055511, 691582151,  94510732, 121413672, 152016732,  2150000,
     5 651982921,  94610382, 113212492, 139515462, 169718482,  3200000,
     6 437347431, 498951671, 538559501,  74710812, 169126672,  1183910,
     7 705183611,  93510092, 111614162, 222932532, 427652992,  2160000,
     8 510869921,  87410312, 123116552, 236530712, 377744832,  3590000,
     9 100010001, 100010051, 105012781, 198535971,  65911422,  1399507/
      DATA NNN19/
     1 461049811, 522254261, 609088131, 168935052,  68612253,  2455908,
     2 759990901, 101911142, 129017782, 302856642,  99414333,  3690000,
     3 200020011, 200720361, 211523021, 269434141, 459163351,   417502,
     4 100010001, 100110321, 129524961,  61014202, 291753192,  2750004,
     5 473650891, 533156051,  66810932, 232950852,  99915303,  4000000,
     6 100110041, 104111741, 146019721, 281941411, 607785251,   569202,
     7 202621931, 255331271, 384347931, 624085761, 122417632,  1102600,
     8 100010001, 100110321, 129524961,  61014202, 291753192,  4300000,
     9 791587851, 100012192, 155119942, 254031782, 389946932,   637900/
      DATA NNN20/
     1 118217102, 220827002, 319036792, 416646512, 513256072,  1223000,
     2  92510012, 104710862, 112311612, 120212472, 132814282,  2050000,
     3 141320802, 291439702, 531170262,  92712273, 162521053,   684000,
     4 354454352, 724689652, 107212643, 148517093, 193321573,  1312900,
     5 209727032, 324537052, 415446282, 510255752, 604965222,  2298000,
     6 256636022, 465759302, 749693962, 116514243, 171520333,   687900,
     7 335157222,  84511463, 147718363, 221826083, 299933893,  1431900,
     8 223725352, 280830972, 340937362, 406844002, 473150632,  2503900,
     9 703972941,  82610822, 154822682, 327244912, 571469372,   709900/
      DATA NNN21/
     1  75714552, 274347322, 718897632, 123414913, 174920063,  1614900,
     2 267645462, 669890262, 115514323, 173620673, 242528083,  2714900,
     3  90613732, 184823562, 291735332, 419949102, 565764332,   728000,
     4 131318312, 227126932, 311735452, 397644072, 483852692,  1525900,
     5 204721673, 234725733, 284031463, 348738613, 426546943,  3000000,
     6 176824122, 318941082, 515263202, 761790472, 106112303,   736400,
     7 221934642, 501968372,  88911173, 136316243, 189221613,  1675900,
     8 210622722, 241025422, 267928262, 297731272, 327834282,  2846000,
     9 148520202, 255230902, 364942462, 489656082, 638872352,   746000/
      DATA NNN22/
     1 153421292, 288137912, 484660322, 720187062, 101011483,  1807000,
     2 254537212, 492362292, 770592182, 107312243, 137615273,  3104900,
     3 115919651, 320746011, 607576761,  95011642, 141817172,   832900,
     4 755087211, 105913442, 173122222, 282034722, 412247732,  1941900,
     5 180223462, 289735212, 414247632, 538460052, 662672472,  3292000,
     6 200020001, 200220141, 206422141, 257633021, 455164681,   757403,
     7 100810581, 125817401, 260641031,  66210072, 135316982,  2148000,
     8 795887491,  97711762, 156620252, 248329422, 340038582,  3481900,
     9 100010001, 100410241, 109212891, 176827421, 444268771,   899003/
      DATA NNN23/
     1 200020021, 201720921, 233329881, 451475371, 127520782,  1690301,
     2 100310281, 114815371, 246138311, 519265531, 791492761,  3747000,
     3 252431921, 368440461, 433746521, 512259221, 723389021,   578400,
     4 100110071, 104611651, 146118581, 225426511, 304734431,  1886000,
     5 200120111, 205021611, 243628031, 317035371, 390442701,  2802900,
     6 232637101, 488058571, 669074381, 816189091,  97210632,   734200,
     7 286335941, 408144471, 479351961, 571862901, 686274341,  1462700,
     8 100010251, 114013811, 175321601, 256829751, 338337901,  3049000,
     9 404043481, 494656811, 646772781, 813490751, 101411372,   863900/
      DATA NNN24/
     1 303147981, 618472951, 827392621, 103711702, 131214532,  1650000,
     2 313037601, 429347901, 536260591, 689477591, 862494881,  2529900,
     3 526258801, 657372351, 784284071, 897095741, 102711082,   900900,
     4 440855541, 686481251,  93810792, 125414792, 176321132,  1860000,
     5 349054751, 699883081,  96611302, 134216202, 197724212,  2800000,
     6 405342041, 438645621, 475751071, 587974491, 102214572,  1045404,
     7 568567471, 773485861,  94510362, 112712182, 130914002,  1909000,
     8 514269581,  86910562, 130716652, 215327742, 351843662,  3200000,
     9 100010001, 100010091, 109515351, 291060661, 119621482,  1212716/
      DATA NNN25/
     1 414844131, 465649111, 538464651,  87112232, 158019362,  2120000,
     2 615475101, 867797531, 112213462, 157618062, 203622662,  3209900,
     3 200020001, 201020501, 215623871, 283536181, 462756261,   389300,
     4 100010001, 100310371, 119016501, 269146361,  77912412,  2510000,
     5 424445601, 481750061, 516953311, 549356551, 581759791,  3500000,
     6 101210791, 135119351, 282340571, 574580391, 111015062,   521002,
     7 262638611, 504160621, 698579371,  91010692, 129115952,  1000000,
     8 100010001, 100310351, 118416321, 264945521,  76512182,  3700000,
     9  71111992, 172323592, 312540402, 510763182, 765791012,   558000/
      DATA NNN26/
     1 204529582, 383647882, 582469262, 807992692, 104911723,  1106000,
     2  94712552, 148416582, 179819212, 203621522, 227424042,  1916900,
     3 295959132, 103515693, 215527593, 335939413, 449650223,   565000,
     4  79718153, 289639443, 495159253, 686877533, 863794813,  1085000,
     5 298640242, 475053692, 596965912, 725379692, 872094692,  2008000,
     6 460693672, 158523823, 327242303, 519661563, 709379783,   541900,
     7 455480232, 114014653, 178521013, 240927073, 299232633,  1055000,
     8  46410533, 183826893, 354443773, 518459633, 674375243,  2320000,
     9 139623042, 364860002,  96114603, 209828633, 373446973,   549000/
      DATA NNN27/
     1 460493692, 158523823, 327142303, 519661563, 709279783,  1073000,
     2 455480232, 114014653, 178521013, 240927073, 299232633,  2000000,
     3 131720482, 280535692, 441254492, 676583972, 103412583,   555000,
     4 139623042, 364860002,  96114603, 209828633, 373446973,  1089900,
     5 460493682, 158523823, 327142303, 519661563, 709279783,  2000000,
     6  92915672, 222431062, 444763802,  89612173, 159520253,   562900,
     7 315059662,  97114563, 204627093, 342541693, 490556383,  1106900,
     8 269037812, 520270372,  91111273, 133915483, 172719093,  2000000,
     9 800080571, 851699301, 127617362, 240433032, 444958442,   568000/
      DATA NNN28/
     1 125416052, 211828182, 375549622, 644381732, 101112213,  1125000,
     2 800080571, 851699301, 127617362, 240433032, 444958442,  2000000,
     3 240432982, 427555202, 708489962, 112613853, 167319843,   615900,
     4 534793262, 139219123, 247730843, 371043333, 495055893,  1210000,
     5 364145232, 514756362, 604864112, 673870372, 732276072,  2000000,
     6 480767202,  89011393, 144118243, 230028753, 354142883,   584900,
     7 480767192,  89011393, 144118243, 230028753, 354142883,  1151900,
     8 480767202,  89011393, 144118243, 230028753, 354142883,  2000000,
     9 343147532, 645887152, 115314793, 183322063, 257729373,   593000/
      DATA NNN29/
     1 343147532, 645887142, 115314793, 183322063, 257729373,  1167000,
     2 343147532, 645887142, 115314793, 183322063, 257729373,  2000000,
     3 222635002, 542276772, 100312353, 145716713, 187020703,   602000,
     4 222635002, 542276772, 100312353, 145716713, 187020703,  1180000,
     5 222635002, 542276772, 100312353, 145716713, 187020703,  2000000,
     6 133715382, 209130152, 429859382,  79410293, 129815983,   609900,
     7 265934782, 497877532, 120517733, 245032063, 400448073,  1193000,
     8 265934782, 497877532, 120517733, 245032063, 400448073,  2000000,
     9 800381111,  87510702, 147621462, 310343462, 585475982,   618000/
      DATA NNN30/
     1 156718872, 279244452, 678196342, 128316243, 197823443,  1205000,
     2  93517192, 364666132, 103414613, 192624193, 293334613,  2370000,
     3 100010011, 101310651, 118613951, 169120661, 250629971,   625000,
     4 200120901, 270345231,  81714042, 223533112, 461959862,  1217000,
     5 100312561, 250851931,  91914182, 198626022, 323638692,  2000000,
     6 514664441, 759086851,  99211442, 133315612, 182721252,   609900,
     7 125924831, 438667801,  98714112, 199727872, 380850742,  1389900,
     8 323948621, 661297271, 158626482, 426865032,  93712843,  1900000,
     9 659294081, 128016962, 222528952, 372047062, 585171462,   700000/
      DATA NNN31/
     1  99117882, 274638812, 520867322,  84410313, 123314453,  1489900,
     2 187427702, 343739872, 448049452, 539358282, 625266642,  2329900,
     3  65210892, 171325762, 373552252, 705192012, 116414343,   787900,
     4 192837842, 600784802, 111113823, 165419233, 218524383,  1620000,
     5  99117872, 274638812, 520867312,  84410313, 123314453,  2400000,
     6 398981651, 130019172, 273438022, 516168382,  88411163,   797900,
     7 131429482, 523279952, 111414623, 183422233, 262130233,  1770000,
     8 192837842, 600784792, 111113823, 165419233, 218524383,  2500000,
     9 600963001,  75910412, 150121572, 301940972, 539168952,   787000/
      DATA NNN32/
     1  73710852, 190731262, 464964142,  83810503, 127315053,  1660000,
     2 131429482, 523279952, 111414623, 183422233, 262130233,  2600000,
     3 110815502, 216829732, 398752322, 672484682, 104612673,   850000,
     4 168225972, 362046562, 566766422, 757484612,  93010103,  1700000,
     5  73710852, 190731262, 464964142,  83810503, 127315053,  2700000,
     6 129117892, 239430882, 388748292, 596173252,  89510843,   910000,
     7 110815502, 216829732, 398752322, 672484682, 104612673,  2000000,
     8 168225972, 362046562, 566766422, 757484612,  93010103,  2800000,
     9 158918512, 207523002, 254328242, 316335762, 407246582,   900000/
      DATA NNN33/
     1  98115462, 224930742, 401150612, 623475412,  89910583,  1855900,
     2 110815502, 216829732, 398752322, 672484682, 104612673,  2900000,
     3 203222611, 265731251, 364042301, 494958601, 702084731,   922000,
     4 120521331, 357753801,  75310062, 130516572, 206925452,  2050000,
     5 651780821, 108814772, 195925252, 316338622, 460853882,  3000000,
     6 100010001, 100110111, 105211851, 152122101, 341552811,  1043002,
     7 200320211, 210023021, 268834231, 480472341, 111416912,  1875000,
     8 104012871, 186129471, 458664151,  82410072, 119013732,  3420000,
     9 200420711, 222424271, 265429161, 325637371, 442853911,   610500/
      DATA NNN34/
     1 100010021, 101910801, 121414641, 189525811, 358949721,  2041900,
     2 200020311, 216624611, 296337451, 489064791,  85711212,  2979900,
     3 103411711, 147819101, 244331781, 434862751,  93113762,   741404,
     4 204122231, 248227841, 311535621, 429153941, 651976431,  1502800,
     5 100210131, 106812201, 154522671, 381665951,  95512512,  3192900,
     6 400140351, 416944121, 474851591, 564362181, 690477231,   728700,
     7 106814451, 204427341, 350744811, 586879131, 108314772,  1667900,
     8 205523051, 264830231, 345439921, 469156001, 675281671,  2555900,
     9 500950661, 518153561, 559058941, 628968071, 748483501,   843000/
      DATA NNN35/
     1 443756241, 696282451,  95411012, 128615262, 182922012,  1900000,
     2 336953201, 682481011,  93810882, 127915272, 184622442,  2700000,
     3 402841621, 431544771, 463148311, 520059491, 734896851,   930000,
     4 576168741, 788387631,  96910642, 116012552, 135014462,  2000000,
     5 490265341, 812797201, 116614322, 179622692, 285035302,  2900000,
     6 100010001, 100010031, 102311051, 133018071, 264539391,  1074500,
     7 402841621, 431544771, 463148311, 520059491, 734996851,  2000000,
     8 576168741, 788387631,  96910642, 116012552, 135014462,  3000000,
     9 200020011, 201220591, 218124481, 296538611, 488859141,   400000/
      DATA NNN36/
     1 100010001, 100010031, 102311051, 133018071, 264539401,  2200000,
     2 421645151, 477449611, 511852711, 542455761, 572958821,  3300000,
     3 100010041, 105212131, 153220271, 270435641, 460258111,   527600,
     4 201221791, 258131471, 381645781, 546365131, 777592781,  1014400,
     5 100010001, 100010031, 102311051, 133018071, 264539391,  3400000,
     6 510064491,  82710872, 142718412, 232328712, 348341572,   690000,
     7 228951571,  88513232, 183324132, 305537492, 448152402,  1210000,
     8 723989131, 103511752, 130814352, 155416652, 177018682,  2000000,
     9 620099241, 162725772, 391457072,  80110833, 141818023,   600000/
      DATA NNN37/
     1 620099241, 162725772, 391457072,  80110833, 141818023,  1200000,
     2 620099251, 162725772, 391457072,  80110833, 141818023,  2000000,
     3 347877992, 129318323, 240730533, 380546863, 570368573,   600000,
     4 347877992, 129318323, 240730533, 380546863, 570368573,  1200000,
     5 347777992, 129318323, 240730533, 380546863, 570368573,  2000000,
     6 209530092, 450866762,  96613623, 186524763, 318839893,   600000,
     7 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     8 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     9 209530092, 450866762,  96613623, 186524763, 318839893,   600000/
      DATA NNN38/
     1 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     2 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     3 209530092, 450866762,  96613623, 186524763, 318839893,   600000,
     4 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     5 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     6 209530092, 450866762,  96613623, 186524763, 318839893,   600000,
     7 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     8 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     9 209530092, 450866762,  96613623, 186524763, 318839893,   600000/
      DATA NNN39/
     1 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     2 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     3 209530092, 450866762,  96613623, 186524763, 318839893,   600000,
     4 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     5 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     6 209530092, 450866762,  96613623, 186524763, 318839893,   600000,
     7 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     8 209530092, 450866762,  96613623, 186524763, 318839893,  2000000,
     9 209530092, 450866762,  96613623, 186524763, 318839893,   600000/
      DATA NNN40/
     1 209530092, 450866762,  96613623, 186524763, 318839893,  1200000,
     2 209530092, 450866762,  96613623, 186524763, 318839893,  2000000/
      DATA NNN67/
     1 893292271,  96110042, 105311262, 126315202, 196126432,  1125508,
     2 595060251, 620865751, 713280191,  95712292, 167623542,  2437501,
     3 105513201, 180324851, 341851341,  88416332, 296550722,  4787101,
     4 204922771, 262630421, 350941931, 494556971, 644872001,  6447600,
     5 100010001, 100010001, 100010001, 100010001, 100010001, 39207700,
     6 200020001, 200020001, 200020001, 200020001, 200020001, 48998100,
     7 403141851, 457051681, 594071181,  92913362, 203331152,  1452915,
     8 919899541, 107211512, 124914302, 182526232, 403762662,  2959202,
     9 596862721, 684177081,  88110342, 128317062, 239334312,  4742501,
     T 112816481, 240733751, 462068491, 116419932, 283736822,  7744900,
     1 210124681, 293634211, 391145791, 539862151, 703178471,  9786200,
     2 100010001, 100010001, 100010001, 100010001, 100010001, 55205700/
      DATA EHYD/0.,82259.105,97492.302,102823.893,105291.651,106632.160/
     ~
      DATA GHYD/2.,8.,18.,32.,50.,72./
      DATA EHE1/0.,159856.069,166277.546,169087.007,171135.000,
     1 183236.892,184864.936,185564.694,186101.654,186105.065,
     2 186209.471,190298.210,190940.331,191217.14,191444.588,
     3 191446.559,191451.80,191452.08,191492.817,
     4 193347.089,193663.627,193800.78,193917.245,193918.391,
     5 193921.31,193921.37,193922.5,193922.5,193942.57/
      DATA GHE1/1.,3.,1.,9.,3.,3.,1.,9.,15.,5.,3.,3.,1.,9.,15.,5.,21.,
     1 7.,3.,3.,1.,9.,15.,5.,21.,7.,27.,9.,3./
      DATA EHE2/0.,329182.321,390142.359,411477.925,421353.135,
     1 426717.413/
      DATA GHE2/2.,8.,18.,32.,50.,72./
      DATA EB1/10.17,28810.,40039.65,47856.99,48613.01,54767.74,
     1 55010.08/
      DATA GB1/6.,12.,2.,10.,6.,10.,2./
      DATA EC1/29.60,10192.66,21648.02,33735.20,60373.00,61981.82,
     1 64088.85,68856.33,69722.00,70743.95,71374.90,72610.72,73975.91,
     2 75254.93/
      DATA GC1/9.,5.,1.,5.,9.,3.,15.,3.,15.,3.,9.,5.,1.,9./
      DATA EC2/42.48,43035.8,74931.11,96493.74,110652.10,116537.65/
      DATA GC2/6.,12.,10.,2.,6.,2./
      DATA EO1/77.975,15867.862,33792.583,73768.200,76794.978,86629.089,
     ~
     1 88630.977,95476.728,96225.049,97420.748,97488.476,99094.065,
     2 99681.051/
      DATA GO1/9.,5.,1.,5.,3.,15.,9.,5.,3.,25.,15.,15.,9./
      DATA ENA1/0.,16956.172,16973.368,25739.991,29172.889,29172.839,
     1 30266.99,30272.58/
      DATA GNA1/2.,2.,4.,2.,6.,4.,2.,4./
      DATA EMG1/0.,21890.854,35051.264,41197.403,43503.333,
     1 46403.065,47847.797,47957.034,49346.729,51872.526,52556.206/
      DATA GMG1/1.,9.,3.,3.,1.,5.,9.,15.,3.,3.,1./
      DATA EMG2/0.,35730.36,69804.95,71490.54,80639.85,92790.51/
      DATA GMG2/2.,6.,2.,10.,6.,2./
      DATA EAL1/74.707,25347.756,29097.11,32436.241,32960.363,
     1 37689.413,38932.139,40275.903,41319.377/
      DATA GAL1/6.,2.,12.,10.,6.,2.,10.,6.,14./
      DATA ESI1/149.681,6298.850,15394.370,33326.053,39859.920,
     1 40991.884,45303.310,47284.061,47351.554,48161.459,49128.131/
      DATA GSI1/9.,5.,1.,5.,9.,3.,15.,3.,5.,15.,9./
      DATA ESI2/191.55,43002.27,55319.11,65500.73,76665.61,79348.67/
      DATA GSI2/6.,12.,10.,2.,2.,10./
      DATA EK1/0.,12985.170,13042.876,21026.551,21534.680,21536.988,
     1 24701.382,24720.139/
      DATA GK1/2.,2.,4.,2.,6.,4.,2.,4./
      DATA ECA1/0.,15263.089,20356.265,21849.634,23652.304,31539.495,
     1 33317.264,35831.203/
      DATA GCA1/1.,9.,15.,5.,3.,3.,1.,21./
      DATA ECA2/0.,13686.60,25340.10,52166.93,56850.78/
      DATA GCA2/2.,10.,6.,2.,10./
      DATA LOCZ/1,3,6,10,14,18,22,27,33,39,45,51,57,63,69,75,81,86,91,
     196,101,106,111,116,121,126,131,136,141/
      DATA SCALE/.001,.01,.1,1./

      data pi/3.141592653589793d+00/, fourpi/12.5637061d+00/
      data bc/1.380626d-16/, h/6.626205d-27/, hev/4.1357d-15/
      data c/2.997925d+10/, elecxsec/6.6524d-25/
      data evtoerg/1.6022d-12/, a/7.56464d-15/
      data stefbltz/5.66956d-05/, hmass/1.67352d-24/
      data esu/4.80298d-10/, emass/9.1091d-28/
      data srpi/1.772453851d+00/, bcev/8.617064d-05/

c - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
      tk = bc * t
      tkev = tk / evtoerg
      hckt = h * c / tk

      MODE1=MODE
      PART(1) = 1.D+00
      PART(2) = 1.D+00
      PART(3) = 1.D+00
      PART(4) = 1.D+00
      PART(5) = 1.D+00
      PART(6) = 1.D+00
      IF(MODE1.GT.10)MODE1=MODE1-10
C     LOWERING OF THE IONIZATION POTENTIAL IN VOLTS FOR UNIT ZEFF
      CHARGE=XNE*2.
      EXCESS=2.*XNE-P/TK
C     ALLOWANCE FOR DOUBLY IONIZED HELIUM
      IF(EXCESS.GT.0.)CHARGE=CHARGE+2.*EXCESS
      IF(CHARGE.EQ.0.)CHARGE=1.
      DEBYE=SQRT(TK/2.8965E-18/CHARGE)
C     DEBYE=SQRT(TK/12.5664/4.801E-10**2/CHARGE)
      POTLOW=MIN(1.D0,1.44E-7/DEBYE)
      TV=TKEV
      IF(IZ.LE.28)N=LOCZ(IZ)
      IF(IZ.GT.28)N=3*IZ+54
      IF(IZ.LE.28)NIONS=LOCZ(IZ+1)-N
      IF(IZ.GT.28)NIONS=3
      IF(IZ.EQ.6)N=354
      IF(IZ.EQ.6)NIONS=6
      IF(IZ.EQ.7)N=360
      IF(IZ.EQ.7)NIONS=6
      NION2=MIN0(NION+2,NIONS)
      N=N-1
C
      DO 18 ION=1,NION2
      Z=ION
      POTLO(ION)=POTLOW*Z
      N=N+1
      NNN100=NNN(6,N)/100
      IP(ION)=DBLE(NNN100)/1000.
      G=NNN(6,N)-NNN100*100
      IF(N.EQ.1)GO TO 1100
      IF(N.EQ.3)GO TO 1110
      IF(N.EQ.4)GO TO 1120
      IF(N.EQ.354)GO TO 1130
      IF(N.EQ.51)GO TO 1140
      IF(N.EQ.57)GO TO 1150
      IF(N.EQ.63)GO TO 1160
      IF(N.EQ.355)GO TO 1132
      IF(N.EQ.52)GO TO 1142
      IF(N.EQ.64)GO TO 1162
      IF(N.EQ.96)GO TO 1170
      IF(N.EQ.97)GO TO 1172
      IF(N.EQ.27)GO TO 1180
      IF(N.EQ.45)GO TO 1190
      IF(N.EQ.14)GO TO 1200
      IF(N.EQ.91)GO TO 1210
      T2000=IP(ION)*2000./11.
      IT=MAX0(1,MIN0(9, INT(T/T2000-.5)))
      DT=T/T2000-DBLE(IT)-.5
      PMIN=1.
      I=(IT+1)/2
      K1=NNN(I,N)/100000
      K2=NNN(I,N)-K1*100000
      K3=K2/10
      KSCALE=K2-K3*10
      IF(MOD(IT,2).EQ.0)GO TO 12
      P1=DBLE(K1)*SCALE(KSCALE)
      P2=DBLE(K3)*SCALE(KSCALE)
      IF(DT.GE.0.)GO TO 13
      IF(KSCALE.GT.1)GO TO 13
      KP1=P1
      IF(KP1.NE. INT(P2+.5))GO TO 13
      PMIN=KP1
      GO TO 13
   12 P1=DBLE(K3)*SCALE(KSCALE)
      K1=NNN(I+1,N)/100000
      KSCALE=MOD(NNN(I+1,N),10)
      P2=DBLE(K1)*SCALE(KSCALE)
   13 PART(ION)= MAX (PMIN,P1+(P2-P1)*DT)
      IF(G.EQ.0..OR.POTLO(ION).LT..1.OR.T.LT.T2000*4.)GO TO 18
      IF(T.GT.(T2000*11.))TV=(T2000*11.)*8.6171E-5
      D1=.1/TV
   14 D2=POTLO(ION)/TV
      PART(ION)=PART(ION)+G*EXP(-IP(ION)/TV)*
     .     (SQRT(13.595*Z*Z/TV/D2)**3*
     .     (1./3.+(1.-(.5+(1./18.+D2/120.)*D2)*D2)*D2)-
     .     SQRT(13.595*Z*Z/TV/D1)**3*
     .     (1./3.+(1.-(.5+(1./18.+D1/120.)*D1)*D1)*D1))
      TV=TKEV
      GO TO 18
 1100 B=1.
      PART(1)=2.*B
      IF(T.LT.9000.)GO TO 18
      DO 1101 I=2,6
      B=1.
 1101 PART(1)=PART(1)+GHYD(I)*B*EXP(-EHYD(I)*HCKT)
      D1=109677.576/6.5/6.5*HCKT
      GO TO 14
 1110 B=1.
      PART(1)=B
      IF(T.LT.15000.)GO TO 18
      DO 1111 I=2,29
      B=1.
 1111 PART(1)=PART(1)+GHE1(I)*B        *EXP(-EHE1(I)*HCKT)
      D1=109677.576/5.5/5.5*HCKT
      GO TO 14
 1120 B=1.
      PART(2)=2.*B
      IF(T.LT.30000.)GO TO 18
      DO 1121 I=2,6
      B=1.
 1121 PART(2)=PART(2)+GHE2(I)*B        *EXP(-EHE2(I)*HCKT)
      D1=4.*109722.267/6.5/6.5*HCKT
      GO TO 14
 1130 B=1.
      PART(1)=B       *(1.+3.*EXP(-16.42*HCKT)+
     1 5.*EXP(-43.42*HCKT))
      DO 1131 I=2,14
      B=1.
 1131 PART(1)=PART(1)+GC1(I)*B       *EXP(-EC1(I)*HCKT)
      PART(1)=PART(1)+108.*EXP(-80000.*HCKT)+
     1 189*EXP(-84000.*HCKT)+247.*EXP(-87000.*HCKT)+
     2 231.*EXP(-88000.*HCKT)+190.*EXP(-89000.*HCKT)+
     3 300.*EXP(-90000.*HCKT)
      GO TO 18
 1132 B=1.
      PART(2)=B*(2.+4.*EXP(-63.42*HCKT))
      DO 1133 I=2,6
      B=1.
 1133 PART(2)=PART(2)+GC2(I)*B*EXP(-EC2(I)*HCKT)
      PART(2)=PART(2)+6.*EXP(-131731.80*HCKT)+
     1 4.*EXP(-142027.1*HCKT)+10.*EXP(-145550.13*HCKT)+
     2 10.*EXP(-150463.62*HCKT)+2.*EXP(-157234.07*HCKT)+
     3 6.*EXP(-162500.*HCKT)+42.*EXP(-168000.*HCKT)+
     4 56.*EXP(-178000.*HCKT)+102.*EXP(-183000.*HCKT)+
     5 400.*EXP(-188000.*HCKT)
      GO TO 18
 1140 B=1.
      PART(1)=B
      DO 1141 I=2,11
      B=1.
 1141 PART(1)=PART(1)+GMG1(I)*B        *EXP(-EMG1(I)*HCKT)
      PART(1)=PART(1)+5.*EXP(-53134.*HCKT)+15.*EXP(-54192.*HCKT)+
     1 28.*EXP(-54676.*HCKT)+9.*EXP(-57853.*HCKT)
      G=4.
      D1=109734.83/4.5/4.5*HCKT
      GO TO 14
 1142 B=1.
      PART(2)=B*2.
      DO 1143 I=2,6
      B=1.
 1143 PART(2)=PART(2)+GMG2(I)*B        *EXP(-EMG2(I)*HCKT)
      PART(2)=PART(2)+10.*EXP(-93310.80*HCKT)+
     1 14.*EXP(-93799.70*HCKT)+6.*EXP(-97464.32*HCKT)+
     2 10.*EXP(-103419.82*HCKT)+14.*EXP(-103689.89*HCKT)+
     3 18.*EXP(-103705.66*HCKT)
      G=2.
      D1=4.*109734.83/5.5/5.5*HCKT
      GO TO 14
 1150 B=1.
      PART(1)=B        *(2.+4.*EXP(-112.061*HCKT))
      DO 1151 I=2,9
      B=1.
 1151 PART(1)=PART(1)+GAL1(I)*B        *EXP(-EAL1(I)*HCKT)
      PART(1)=PART(1)+10.*EXP(-42235.*HCKT)+14.*EXP(-43831.*HCKT)
      G=2.
      D1=109735.08/5.5/5.5*HCKT
      GO TO 14
 1160 B=1.
      PART(1)=B        *(1.+3.*EXP(-77.115*HCKT)+
     1 5.*EXP(-223.157*HCKT))
      DO 1161 I=2,11
      B=1.
 1161 PART(1)=PART(1)+GSI1(I)*B        *EXP(-ESI1(I)*HCKT)
      PART(1)=PART(1)+76.*EXP(-53000.*HCKT)+71.*EXP(-57000.*HCKT)+
     1 191.*EXP(-60000.*HCKT)+240.*EXP(-62000.*HCKT)+
     2 251.*EXP(-63000.*HCKT)+300.*EXP(-65000.*HCKT)
      GO TO 18
 1162 B=1.
      PART(2)=B*(2.+4.*EXP(-287.32*HCKT))
      DO 1163 I=2,6
      B=1.
 1163 PART(2)=PART(2)+GSI2(I)*B        *EXP(-ESI2(I)*HCKT)
      PART(2)=PART(2)+6.*EXP(-81231.59*HCKT)+
     1 6.*EXP(-83937.08*HCKT)+10.*EXP(-101024.09*HCKT)+
     2 14.*EXP(-103556.35*HCKT)+10.*EXP(-108800.*HCKT)+
     3 42.*EXP(-115000.*HCKT)+6.*EXP(-121000.*HCKT)+
     4 38.*EXP(-125000.*HCKT)+34.*EXP(-132000.*HCKT)
      G=2.
      D1=4.*109734.83/4.5/4.5*HCKT
      GO TO 14
 1170 B=1.
      PART(1)=B
      DO 1171 I=2,8
      B=1.
 1171 PART(1)=PART(1)+GCA1(I)*B        *EXP(-ECA1(I)*HCKT)
      PART(1)=PART(1)+28.*EXP(-37000.*HCKT)+67.*EXP(-40000.*HCKT)+
     1 21.*EXP(-43000.*HCKT)+34.*EXP(-48000.*HCKT)
      G=4.
      D1=109734.82/4.5/4.5*HCKT
      GO TO 14
 1172 B=1.
      PART(2)=B*2.
      DO 1173 I=2,5
      B=1.
 1173 PART(2)=PART(2)+GCA2(I)*B        *EXP(-ECA2(I)*HCKT)
      PART(2)=PART(2)+12.*EXP(-68000.*HCKT)
      G=2.
      D1=109734.83/4.5/4.5*HCKT
      GO TO 14
 1180 B=1.
      PART(1)=B*(5.+3.*EXP(-158.265*HCKT)+EXP(-226.977*HCKT))
      DO 1181 I=2,13
      B=1.
 1181 PART(1)=PART(1)+GO1(I)*B*EXP(-EO1(I)*HCKT)
      PART(1)=PART(1)+15.*EXP(-101140.*HCKT)+
     1 131.*EXP(-103000.*HCKT)+128.*EXP(-105000.*HCKT)+
     2 600.*EXP(-107000.*HCKT)
      GO TO 18
 1190 B=1.
      PART(1)=B*2.
      DO 1191 I=2,8
      B=1.
 1191 PART(1)=PART(1)+GNA1(I)*B*EXP(-ENA1(I)*HCKT)
      PART(1)=PART(1)+10.*EXP(-34548.745*HCKT)+
     1 14.*EXP(-34586.96*HCKT)
      G=2.
      D1=109734.83/4.5/4.5*HCKT
      GO TO 14
 1200 B=1.
      PART(1)=B*(2.+4.*EXP(-15.25*HCKT))
      DO 1201 I=2,7
      B=1.
 1201 PART(1)=PART(1)+GB1(I)*B*EXP(-EB1(I)*HCKT)
      PART(1)=PART(1)+6.*EXP(-57786.80*HCKT)+
     1 10.*EXP(-59989.*HCKT)+14.*EXP(-60031.03*HCKT)+
     2 2.*EXP(-63561.*HCKT)
      G=2.
      D1=109734.83/4.5/4.5*HCKT
      GO TO 14
 1210 B=1.
      PART(1)=B*2.
      DO 1211 I=2,8
      B=1.
 1211 PART(1)=PART(1)+GK1(I)*B*EXP(-EK1(I)*HCKT)
      PART(1)=PART(1)+10.*EXP(-27397.077*HCKT)+
     1 14.*EXP(-28127.85*HCKT)
      G=2.
      D1=109734.83/5.5/5.5*HCKT
      GO TO 14
   18 CONTINUE
C
      IF(MODE1.EQ.3)GO TO 35
C
      N=N-NION2
      CF=2.*2.4148D15*T*SQRT(T)/XNE
      DO 20 ION=2,NION2
      N=N+1
C     THE AMIN IS FOR ANY UNFORTUNATE WHO HAS A 360
   20 F(ION)=CF*PART(ION)/PART(ION-1)*
     1EXP(-MIN((IP(ION-1)-POTLO(ION-1))/TV,75.D0))
      F(1)=1.
      IF(NION2.LT.9)GO TO 1050
      FMAX=1.
      FSAVE(1)=1.
      DO 1022 ION=2,NION2
      FSAVE(ION)=F(ION)
 1022 FMAX=MAX(FMAX,F(ION))
      DO 1023 IMAX=1,NION2
      IF(F(IMAX).EQ.FMAX)GO TO 1024
 1023 CONTINUE
 1024 IF(IMAX.EQ.1)GO TO 1050
      IF(NION2.EQ.2)GO TO 1050
      SUM=0.
      DO 1026 ION=1,NION2
      PROD=1.
      DO 1025 JION=1,NION2
      IEX=1
      IF(JION.GT.ION.AND.JION.GT.IMAX)GO TO 1025
      IF(ION.LE.IMAX)GO TO 1025
      IF(JION.LE.IMAX)IEX=-1
      IF(IEX.EQ.1)PROD=PROD*F(JION)
      IF(IEX.EQ.-1)PROD=PROD/F(JION)
 1025 CONTINUE
 1026 SUM=SUM+PROD
      F(IMAX)=1./SUM
      DO 1027 ION=2,IMAX
      L=IMAX-ION+2
 1027 F(L-1)=F(L)/FSAVE(L)
      IF(IMAX.EQ.NION2)GO TO 35
      DO 1028 ION=IMAX+1,NION2
 1028 F(ION)=F(ION-1)*FSAVE(ION)
      GO TO 35
 1050 L=NION2+1
      DO 21 ION=2,NION2
      L=L-1
   21 F(1)=1.+F(L)*F(1)
      F(1)=1./F(1)
      DO 22 ION=2,NION2
   22 F(ION)=F(ION-1)*F(ION)
C
   35 IF(MODE.LT.10)GO TO 40
      GO TO(23,25,27,29),MODE1
   23 DO 24 ION=1,NION
   24 ANSWER(ION)=F(ION)/PART(ION)
      RETURN
   25 DO 26 ION=1,NION
   26 ANSWER(ION)=F(ION)
      RETURN
   27 DO 28 ION=1,NION
   28 ANSWER(ION)=PART(ION)
      RETURN
   29 ANSWER(1)=0.
      DO 30 ION=2,NION2
   30 ANSWER(1)=ANSWER(1)+F(ION)*DBLE(ION-1)
      RETURN
   40 GO TO(41,42,43,29),MODE1
   41 ANSWER(1)=F(NION)/PART(NION)
      RETURN
   42 ANSWER(1)=F(NION)
      RETURN
   43 ANSWER(1)=PART(NION)
      RETURN
      END
