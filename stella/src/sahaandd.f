      SUBROUTINEURSOS
      IMPlICITREAL*8(A-H,O-Z)
      PARAMETER(NVARS=3)
      include '../obj/nfreq_and_mzone.inc'
      PARAMETER(NYDIM=(NVARS+2*NFREQ)*Mzon,MAXDER=4)
      Parameter(Is=5)
      PARAMETER(NZ=3000000)
      Parameter(Nstage=28,Natom=15)
      PARAMETER(KOMAX=80)
      LogicalLSYSTEM
      Parameter(LSystem=.FALSE.)
      Parameter(Pi=3.1415926535897932d+00,hPlanc=1.0545716280D-27,Cs=2.9979245800D+10,Boltzk=1.3806504000D-16,Avogar=6.0221417900D+2
     *3,AMbrun=1.6605387832D-24,AMelec=9.1093821500D-28,echarg=4.8032042700D-10,CG=6.6742800000D-08,CMS=1.9884000000D+33,RSol=6.9551
     *000000D+10,ULGR=1.4000000000D+01,UPURS=1.0000000000D+07,ULGPU=7.0000000000D+00,ULGEU=1.3000000000D+01,UPC=3.0856776000D+18,UTP
     *=1.0000000000D+05,URHO=1.0000000000D-06,CARAD=7.5657680191D-15,CSIGM=5.6704004778D-05,ERGEV=1.6021764864D-12,GRADeV=1.16045052
     *85D+04,RADC=7.5657680191D-02,CTOMP=4.0062048575D-01,CCAPS=2.6901213726D+01,CCAPZ=9.8964034725D+00)
      IntegerZn(Natom),ZnCo(Natom+1)
      DimensionAZ(Natom)
      Common/AZZn/AZ,Zn,ZnCo
      LogicalRadP
      COMMON/RadP/RadP
      COMMON/ARG/TP,PL,CHEM,LST,KENTR,JURS
      COMMON/RESULT/P,Egas,Sgas,ENG,CAPPA,PT,ET,ST,ENGT,CAPT,NZR
      COMMON/ABUND/XYZA,Yat(Natom)
      COMMON/AZ/AS,ZS,SCN
      COMMON/STR/PPL,EPL,SPL,ENGPL,CAPPL,CP,GAM,DA,DPE,DSE,DSP,BETgas
      COMMON/XELECT/XE,XET,XEPL,PE,Ycomp
      COMMON/URScap/Tpsqrt,Psicap,Scap,ScapT,ScapPl,ZMean,YZMean,ZMT,ZMPl,YZMT,YZMPl
      Parameter(tret=1.d0/3.d0)
      Parameter(tret2=2.d0/3.d0)
      Parameter(epsurs=1.d-8,Xeflo=1.d-20,Xiflo=1.d-7)
      Parameter(epslow=1.d-10,huge=1.d100)
      DimensionYal(Natom),Yalx(Natom),xasaha(Natom),yasaha(Natom),al(Natom),aldT(Natom),sigYal(Natom),jmin(Natom),jmax(Natom),AD(Nst
     *age,Natom),AR(Nstage,Natom)
      LogicalLOW,HIGH
      COMMON/NIT/Xelow,Xion(0:Nstage,Natom),Nit,LOW,HIGH
      Parameter(CPSI=3.0176176020D-04,CPRESS=1.0035958999D-04,CRGAS=8.3144721451D-01,CAvD=6.0221419900D+17,CSaha=1.5271823083D+23,DL
     *OW=1.0000000000D+05,DUP=1.0000000000D+08,CWW=1.4476482730D-01,CLOW=1.6666666667D+00)
      Parameter(Zf=1.2000000000D+01,Tpzb=3.8875094954D+00,Tpzf=1.4818760698D+02)
      DIMENSIONPION(Nstage,Natom)
      DIMENSIONPsum(Nstage,Natom)
      DIMENSIONGWgL(Nstage,Natom)
      DIMENSIONGWcL(Nstage,Natom)
      Character*2Chames(Natom)
      DATAPION/1.577633D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,
     *0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,2.852
     *388D+00,6.312851D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.307132D+00,2.8287
     *14D+00,5.554381D+00,7.482121D+00,4.548804D+01,5.684351D+01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+0
     *0,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.687295D+00,3.435514D+00,5.50355
     *3D+00,8.987690D+00,1.135652D+01,6.404817D+01,7.738233D+01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0
     *00000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.579837D+00,4.078520D+00,6.374819D+00,8.981191
     *D+00,1.321440D+01,1.602350D+01,8.577053D+01,1.010892D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00
     *0000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,
     *0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,2.501815D+00,4.765971D+00,7.426884D+00,1.127494D+01,1.466810D
     *+01,1.832468D+01,2.405614D+01,2.774637D+01,1.280093D+02,1.580766D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000
     *000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,5.962395D-01,5.487771D+00,8.314629D+00,1.147686D+01,1.606064D+01,1.997135D+
     *01,2.419539D+01,3.065910D+01,3.480191D+01,1.700176D+02,1.913235D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0000
     *00D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,8.870484D-01,1.740676D+00,9.295209D+00,1.268373D+01,1.639717D+01,2.164240D+01,2.611014D+0
     *1,3.085638D+01,3.806278D+01,4.263495D+01,2.044250D+02,2.277500D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00000
     *0D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0
     *00000D+00,0.000000D+00,6.944136D-01,2.181647D+00,3.295680D+00,1.392541D+01,1.784773D+01,2.210658D+01,2.801328D+01,3.302642D+01
     *,3.831808D+01,4.625556D+01,5.128031D+01,2.420700D+02,2.673794D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00
     *0000D+00,9.457672D-01,1.891534D+00,3.887509D+00,5.233632D+00,1.935632D+01,2.381245D+01,2.860511D+01,3.517326D+01,4.074342D+01,
     *4.658049D+01,5.524905D+01,6.072638D+01,2.828830D+02,3.102000D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.202
     *227D+00,2.715454D+00,4.061577D+00,5.488931D+00,8.436476D+00,1.021197D+01,3.260866D+01,3.810920D+01,4.398108D+01,5.188375D+01,5
     *.855634D+01,6.550744D+01,7.564977D+01,8.202065D+01,3.741061D+02,4.054614D+02,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.828870D+00,3.2028
     *44D+00,4.746243D+00,6.927890D+00,8.726588D+00,1.058331D+01,1.444761D+01,1.664086D+01,4.906385D+01,5.559719D+01,6.254829D+01,7.
     *177387D+01,7.957210D+01,8.764883D+01,9.925334D+01,1.065294D+02,4.782217D+02,5.136154D+02,0.000000D+00,0.000000D+00,0.000000D+0
     *0,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,7.091514D-01,1.377455D+00,5.94150
     *7D+00,7.809833D+00,9.805808D+00,1.262570D+01,1.485377D+01,1.712825D+01,2.190931D+01,2.452032D+01,6.868707D+01,7.626481D+01,8.4
     *31834D+01,9.487844D+01,1.038023D+02,1.130279D+02,1.261410D+02,1.342641D+02,5.951951D+02,6.347665D+02,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,9.167560D-01,1.878537D+00,3.557013D+00,6.359269
     *D+00,8.703379D+00,1.150007D+01,1.450331D+01,1.752988D+01,2.725898D+01,3.040381D+01,3.368788D+01,3.838771D+01,4.189227D+01,4.54
     *8966D+01,5.303259D+01,5.686208D+01,1.467970D+02,1.575892D+02,1.689616D+02,1.835833D+02,1.960001D+02,2.087651D+02,2.262879D+02,
     *2.373121D+02,1.024446D+03,1.076666D+03,0.000000D+00,0.000000D+00,8.862941D-01,2.108423D+00,4.083626D+00,6.370874D+00,8.826387D
     *+00,1.253287D+01,1.543399D+01,1.879930D+01,2.239670D+01,2.606372D+01,3.725046D+01,4.084786D+01,4.456130D+01,4.989938D+01,5.384
     *491D+01,5.790648D+01,6.626173D+01,7.055540D+01,1.794057D+02,1.912423D+02,2.037751D+02,2.197893D+02,2.333666D+02,2.472920D+02,2
     *.663234D+02,2.783921D+02,1.193964D+03,1.250441D+03/
      DATAPsum/1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,
     *1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D
     *+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,1.577633D+00,2.852
     *388D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9
     *.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+
     *00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,9.165239D+00,1.307132D+00,4.1358
     *46D+00,9.690227D+00,1.717235D+01,6.266039D+01,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.
     *195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+0
     *2,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.195039D+02,1.687295D+00,5.122809D+00,1.06263
     *6D+01,1.961405D+01,3.097057D+01,9.501874D+01,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.7
     *24011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02
     *,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.724011D+02,1.579837D+00,5.658357D+00,1.203318D+01,2.101437
     *D+01,3.422877D+01,5.025227D+01,1.360228D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.37
     *1120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,
     *2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.371120D+02,2.501815D+00,7.267786D+00,1.469467D+01,2.596961D+01,4.063770D
     *+01,5.896238D+01,8.301852D+01,1.107649D+02,2.387742D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968
     *508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,3
     *.968508D+02,3.968508D+02,3.968508D+02,3.968508D+02,5.962395D-01,6.084010D+00,1.439864D+01,2.587550D+01,4.193613D+01,6.190749D+
     *01,8.610288D+01,1.167620D+02,1.515639D+02,3.215815D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.1290
     *50D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.129050D+02,5.
     *129050D+02,5.129050D+02,5.129050D+02,8.870484D-01,2.627724D+00,1.192293D+01,2.460666D+01,4.100383D+01,6.264623D+01,8.875637D+0
     *1,1.196127D+02,1.576755D+02,2.003105D+02,4.047355D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.32485
     *5D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.324855D+02,6.3
     *24855D+02,6.324855D+02,6.944136D-01,2.876061D+00,6.171740D+00,2.009715D+01,3.794488D+01,6.005146D+01,8.806474D+01,1.210912D+02
     *,1.594092D+02,2.056648D+02,2.569451D+02,4.990151D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945
     *D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.663945D+02,7.66
     *3945D+02,9.457672D-01,2.837302D+00,6.724811D+00,1.195844D+01,3.131476D+01,5.512721D+01,8.373231D+01,1.189056D+02,1.596490D+02,
     *2.062295D+02,2.614785D+02,3.222049D+02,6.050880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D
     *+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,9.152880D+02,1.202
     *227D+00,3.917681D+00,7.979258D+00,1.346819D+01,2.190467D+01,3.211663D+01,6.472529D+01,1.028345D+02,1.468156D+02,1.986993D+02,2
     *.572557D+02,3.227631D+02,3.984129D+02,4.804335D+02,8.545396D+02,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+
     *03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.260001D+03,1.828870D+00,5.0317
     *14D+00,9.777957D+00,1.670585D+01,2.543244D+01,3.601574D+01,5.046335D+01,6.710422D+01,1.161681D+02,1.717653D+02,2.343135D+02,3.
     *060874D+02,3.856595D+02,4.733083D+02,5.725617D+02,6.790910D+02,1.157313D+03,1.670928D+03,1.670928D+03,1.670928D+03,1.670928D+0
     *3,1.670928D+03,1.670928D+03,1.670928D+03,1.670928D+03,1.670928D+03,1.670928D+03,1.670928D+03,7.091514D-01,2.086606D+00,8.02811
     *3D+00,1.583795D+01,2.564375D+01,3.826946D+01,5.312322D+01,7.025147D+01,9.216078D+01,1.166811D+02,1.853682D+02,2.616330D+02,3.4
     *59513D+02,4.408298D+02,5.446321D+02,6.576600D+02,7.838009D+02,9.180651D+02,1.513260D+03,2.148027D+03,2.148027D+03,2.148027D+03
     *,2.148027D+03,2.148027D+03,2.148027D+03,2.148027D+03,2.148027D+03,2.148027D+03,9.167560D-01,2.795293D+00,6.352307D+00,1.271158
     *D+01,2.141496D+01,3.291502D+01,4.741833D+01,6.494821D+01,9.220720D+01,1.226110D+02,1.562989D+02,1.946866D+02,2.365789D+02,2.82
     *0685D+02,3.351011D+02,3.919632D+02,5.387602D+02,6.963494D+02,8.653110D+02,1.048894D+03,1.244894D+03,1.453659D+03,1.679947D+03,
     *1.917259D+03,2.941705D+03,4.018371D+03,4.018371D+03,4.018371D+03,8.862941D-01,2.994717D+00,7.078342D+00,1.344922D+01,2.227560D
     *+01,3.480847D+01,5.024246D+01,6.904176D+01,9.143846D+01,1.175022D+02,1.547526D+02,1.956005D+02,2.401618D+02,2.900612D+02,3.439
     *061D+02,4.018126D+02,4.680743D+02,5.386297D+02,7.180354D+02,9.092776D+02,1.113053D+03,1.332842D+03,1.566209D+03,1.813501D+03,2
     *.079824D+03,2.358216D+03,3.552181D+03,4.802622D+03/
      DATAGWgL/-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,6.93
     *1472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-4.054651D-01,-1.
     *791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000
     *000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,8.109302D-01,-4.054651D-01,
     *-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0000
     *00D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-8.109302D-01,8.109302D-01,-4.054651D
     *-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+0
     *0,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.791759D+00,4.054651D-01,-8.109302D-01,8.1093
     *02D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+0
     *0,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00000
     *0D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D-01,8
     *.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.0000
     *00D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,6.931472D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D
     *-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.1
     *09302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00
     *0000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,4.054651D-
     *01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1.
     *791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.9314
     *72D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.
     *000000D+00,0.000000D+00,0.000000D+00,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472
     *D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01
     *,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.00000
     *0D+00,0.000000D+00,0.000000D+00,6.931472D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,
     *-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.93
     *1472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+0
     *0,0.000000D+00,0.000000D+00,1.823216D-01,-1.823216D-01,-1.427116D+00,1.427116D+00,1.133287D-01,-2.876821D-01,-7.419373D-01,-2.
     *302585D+00,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1.79175
     *9D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-0
     *1,0.000000D+00,0.000000D+00,-7.419373D-01,7.419373D-01,2.876821D-01,-1.133287D-01,-1.427116D+00,1.427116D+00,1.133287D-01,-2.8
     *76821D-01,-7.419373D-01,-2.302585D+00,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.93147
     *2D-01,-6.931472D-01,1.791759D+00,4.054651D-01,-8.109302D-01,8.109302D-01,-4.054651D-01,-1.791759D+00,6.931472D-01,-6.931472D-0
     *1,6.931472D-01,-6.931472D-01/
      DATAGWcL/-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,6.93
     *1472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00
     *,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000
     *D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-9.162907D-01,-1.
     *791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000
     *000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-2.876821D-01,-9.162907D-01
     *,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000
     *000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,2.876821D-01,-2.876821D-01,-9.162907
     *D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,1.791759D+00,9.162907D-01,2.876821D-01,-2.876
     *821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0000
     *00D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D-01,-
     *2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000
     *000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,6.931472D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D
     *-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,
     *0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.8
     *76821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.00000
     *0D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0
     *00000D+00,0.000000D+00,0.000000D+00,0.000000D+00,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,9.162907D
     *-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,
     *0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D
     *+00,0.000000D+00,0.000000D+00,0.000000D+00,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1
     *.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931
     *472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0
     *.000000D+00,0.000000D+00,0.000000D+00,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.93147
     *2D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-0
     *1,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.0000
     *00D+00,0.000000D+00,0.000000D+00,6.931472D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01
     *,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.9
     *31472D-01,-6.931472D-01,6.931472D-01,-6.931472D-01,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+00,0.000000D+
     *00,0.000000D+00,0.000000D+00,6.931472D-01,-6.931472D-01,1.823216D-01,-1.823216D-01,-5.596158D-01,-9.808293D-01,-1.504077D+00,-
     *2.302585D+00,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,1.791
     *759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D-01,6.931472D-01,-6.931472D
     *-01,0.000000D+00,0.000000D+00,-1.504077D+00,1.504077D+00,9.808293D-01,5.596158D-01,1.823216D-01,-1.823216D-01,-5.596158D-01,-9
     *.808293D-01,-1.504077D+00,-2.302585D+00,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931
     *472D-01,-6.931472D-01,1.791759D+00,9.162907D-01,2.876821D-01,-2.876821D-01,-9.162907D-01,-1.791759D+00,6.931472D-01,-6.931472D
     *-01,6.931472D-01,-6.931472D-01/
      DataChames/'H ','He','C ','N ','O ','Ne','Na','Mg','Al','Si','S ','Ar','Ca','Fe','Ni'/
      GOTO09993
09999 CONTINUE
      Dsaha=log(Csaha*Tpsqrt*Rnbar)
      Egas=0.D0
      If(LST.NE.0)Then
      PT=0.D0
      ET=0.D0
      PPl=0.D0
      EPl=0.D0
      endif
      Asum=0.d0
      DO09990i=1,Natom
      AD(1,i)=exp(Dsaha-Pion(1,i)*RTp+GWgL(1,i))
      Asum=Asum+AD(1,i)*Yat(i)
09990 CONTINUE
      If(Asum.LT.EpsLOW)Then
      LOW=.TRUE.
      Xe=Sqrt(Asum)
      XeLOW=Sqrt(Asum)
      RXe=1.d0/(max(Xe,Xeflo))
      else
      LOW=.FALSE.
      jmin(1)=0
      jmax(1)=1
      DO09987i=2,Natom
      j=1
09984 IF(.NOT.(AD(j,i).GT.1.d0/Xiflo.AND.j.LT.Zn(i)))GOTO09983
      j=j+1
      AD(j,i)=exp(Dsaha-Pion(j,i)*RTp+GWgL(j,i))
      GOTO09984
09983 CONTINUE
      jmin(i)=j-1
      if(j.EQ.Zn(i).OR.AD(j,i).LT.Xiflo*sqrt(epslow))then
      jmax(i)=j
      else
      ADfact=AD(j,i)
09981 IF(.NOT.(ADfact.GT.Xiflo*sqrt(epslow).AND.j.LT.Zn(i)))GOTO09980
      j=j+1
      ADln=Dsaha-Pion(j,i)*RTp+GWgL(j,i)
      if(ADln.GT.-3.d2*log(10.d0))then
      ADfact=exp(ADln)
      else
      ADfact=0.d0
      endif
      AD(j,i)=AD(j-1,i)*ADfact
      GOTO09981
09980 CONTINUE
      if(ADfact.LT.Xiflo*sqrt(epslow))then
      jmax(i)=j-1
      else
      jmax(i)=Zn(i)
      endif
      endif
09987 CONTINUE
      Xe=max(CHEM,sqrt(epslow))
      RXe=1.d0/Xe
      endif
      NIT=0
      If(.NOT.LOW)Then
      RXeold=0.d0
09978 IF(.NOT.(ABS(Rxeold-Rxe).GT.epsurs*Rxe.AND.NIT.LT.64))GOTO09977
      RXeold=RXe
      U=0.d0
      V=0.d0
      DO09975i=1,Natom
      alpha=0.d0
      doj=jmin(i)+1,jmax(i)
      if(RXe**(j-jmin(i)).GT.huge)RXe=huge**(1.d0/dble(j-jmin(i)))
      AR(j,i)=AD(j,i)*RXe**(j-jmin(i))
      alpha=alpha+AR(j,i)
      enddo
      alpha=1.d0/(1.d0+alpha)
      al(i)=alpha
      xa=dble(jmin(i))*alpha
      ya=dble(jmin(i)**2)*alpha
      DO09972j=jmin(i)+1,jmax(i)
      arj=dble(j)*AR(j,i)*alpha
      xa=xa+arj
      ya=ya+dble(j)*arj
09972 CONTINUE
      Yal(i)=Yat(i)*alpha
      xasaha(i)=xa
      yasaha(i)=ya
      Yalx(i)=Yat(i)*xa
      U=U+Yalx(i)
      V=V+Yat(i)*(ya-xa**2)
09975 CONTINUE
      RXe=abs((Rxeold*V+1.D0)/(V+U))
      NIT=NIT+1
      GOTO09978
09977 CONTINUE
      If(NIT.GE.64)then
      Write(6,*)' Iterations in SAHAandd fail to converge'
      Write(6,*)' Tp=',Tp,'  Pl=',Pl,'   Rxeold=',Rxeold,'   Rxe=',Rxe,'  epsurs=',epsurs
      STOP
      endif
      Xe=1.d0/Rxe
      Endif
      Xe=max(Xe,Xeflo)
      if(LOW)Then
      Zmean=0.d0
      DO09969i=1,Natom
      Xion(1,i)=AD(1,i)*RXe
      Xion(0,i)=1.d0-Xion(1,i)
      DO09966j=2,Zn(i)
      Xion(j,i)=0.D0
09966 CONTINUE
      Zmean=Zmean+Yat(i)*Xion(1,i)
09969 CONTINUE
      else
      Zmean=0.d0
      DO09963i=1,Natom
      Sumx=0.d0
      Zsum=0.d0
      DO09960j=0,jmin(i)-1
      Xion(j,i)=0.d0
09960 CONTINUE
      DO09957j=jmax(i)+1,Zn(i)
      Xion(j,i)=0.d0
09957 CONTINUE
      DO09954j=jmin(i)+1,jmax(i)
      Xion(j,i)=Ar(j,i)*al(i)
      sumx=sumx+xion(j,i)
      Zsum=Zsum+dble(j)**2*Xion(j,i)
09954 CONTINUE
      xion(jmin(i),i)=al(i)
      sumx=sumx+xion(jmin(i),i)
      Zsum=Zsum+dble(jmin(i))**2*Xion(jmin(i),i)
      if(abs(sumx-1.d0).GT.epsurs)then
      write(*,*)' sum(xion) in Saha for ',Chames(i),' =',sumx
      stop
      endif
      Zmean=Zmean+Yat(i)*Zsum
09963 CONTINUE
      endif
      Zmean=Zmean*RXe
      P=CRgas*(XYZA+Xe)*Pl*Tp
      If(LOW)Then
      WEgas=0.d0
      DO09951i=1,Natom
      WEgas=WEgas+AD(1,i)*Psum(1,i)*Yat(i)*RXe
09951 CONTINUE
      Else
      WEgas=0.d0
      DO09948i=1,Natom
      if(jmin(i).EQ.0)then
      W=0.d0
      else
      W=Psum(jmin(i),i)*Yal(i)
      endif
      DO09945j=jmin(i)+1,jmax(i)
      W=W+Psum(j,i)*AR(j,I)*Yal(i)
09945 CONTINUE
      WEgas=WEgas+W
      sigYal(i)=W
09948 CONTINUE
      Endif
      Egas=Egas+CRgas*(1.5d0*(XYZA+Xe)*Tp+WEgas)
      IF(LST.NE.0)THEN
      if(LOW)Then
      yaddT=0.D0
      DO09942i=1,Natom
      yad=Yat(i)*AD(1,i)
      yaddT=yaddT+yad*(1.5D0+Psum(1,i)*RTp)
09942 CONTINUE
      XeT=0.5d0*yaddT*(RXe*RTp)
      XePl=0.5d0*Asum*RXe-Xe
      XeTl=XeT*RXe
      ZMT=(yaddT*RTp-Asum*XeTl)*RXe**2-Zmean*XeTl
      if(ZMT.LT.0.d0)ZMT=0.d0
      ZMPl=-RXe**2*(1.d0+RXe*XePl)*Asum-Zmean*RXe*XePl
      if(ZMPl.GT.0.d0)ZMPl=0.d0
      DET=0.D0
      DePl=0.d0
      DO09939i=1,Natom
      DET=DET+Yat(i)*(AD(1,i)*RXe)*Psum(1,i)*((1.5D0+Psum(1,i)*RTp)*RTp-XeTl)
      DEPl=DEPl+Yat(i)*(AD(1,i)*RXe)*Psum(1,i)
09939 CONTINUE
      ET=ET+CRgas*(1.5D0*(XYZA+Xe+Tp*XeT)+DET)
      EPl=EPl+CRgas*(1.5D0*Tp*XePl-DePl*(XePl*RXe+1.d0))
      else
      DGT=0.d0
      ZMT=0.d0
      dZMXe=0.d0
      DO09936i=1,Natom
      alpT=0.d0
      xsahaT=0.d0
      ysahaT=0.d0
      sarj=0.d0
      sarjj2=0.d0
      if(jmin(i).EQ.0)then
      Pmin=0.d0
      else
      Pmin=Psum(jmin(i),i)
      endif
      DO09933j=jmin(i)+1,jmax(i)
      arj=(dble(j)-dble(jmin(i)))*AR(j,i)
      sarj=sarj+arj
      sarjj2=sarjj2+dble(j)**2*arj
      alT=1.5D0*arj+(Psum(j,i)-Pmin)*RTp*AR(j,i)
      alpT=alpT+alT
      xsahaT=xsahaT+alT*dble(j)
      ysahaT=ysahaT+alT*dble(j)**2
09933 CONTINUE
      alpT=alpT*RTp
      xsahaT=xsahaT*RTp
      ysahaT=ysahaT*RTp
      DGT=DGT+Yal(i)*xsahaT-Yalx(i)*(alpT*al(i))
      ZMT=ZMT+Yal(i)*ysahaT-(Yal(i)*yasaha(i)*alpT)
      dZMXe=dZMXe+(Yat(i)*yasaha(i))*(sarj*al(i))-(Yal(i)*sarjj2)
      aldT(i)=alpT
09936 CONTINUE
      XeT=DGT/(V*RXe+1.D0)
      XePl=-V/(V*RXe+1.D0)
      XeTl=XeT*RXe
      ZMT=RXe*(ZMT+XeTl*dZMXe)-Zmean*XeTl
      if(ZMT.LT.0.d0)ZMT=0.d0
      ZMPl=RXe*(1.d0+RXe*XePl)*dZMXe-Zmean*RXe*XePl
      if(ZMPl.GT.0.d0)ZMPl=0.d0
      DET=0.d0
      DEPl=0.d0
      DO09930i=1,Natom
      sigmT=0.d0
      signe=0.d0
      if(jmin(i).EQ.0)then
      Pmin=0.d0
      else
      Pmin=Psum(jmin(i),i)
      endif
      DO09927j=jmin(i)+1,jmax(i)
      sigmT=sigmT+Psum(j,i)*AR(j,i)*((1.5D0*(dble(j)-dble(jmin(i)))+(Psum(j,i)-Pmin)*RTp)*RTp-(dble(j)-dble(jmin(i)))*XeTl)
      signe=signe+(dble(j)-dble(jmin(i)))*AR(j,i)*Psum(j,i)
09927 CONTINUE
      DET=DET+Yal(i)*sigmT-sigYal(i)*(aldT(i)*al(i)-XeTl*(xasaha(i)-jmin(i)))
      DEPl=DEPl+Yal(i)*signe-sigYal(i)*(xasaha(i)-jmin(i))
09930 CONTINUE
      ET=ET+CRgas*(1.5D0*(XYZA+Xe+Tp*XeT)+DET)
      EPl=EPl+CRgas*(1.5D0*Tp*XePl-DePl*(XePl*RXe+1.d0))
      endif
      PPl=PPl+CRgas*(XYZA+Xe+XePl)*Tp
      PT=PT+CRgas*(XYZA+Xe+Tp*XeT)*Pl
      ENDIF
      CHEM=Xe
      GOTO(09997,09994),I6R001
09993 CONTINUE
      GOTO09924
09998 CONTINUE
      ZMean=Zf
      XeZM=ZMean*YZ
      YZMean=YZ
      Ye=Yat(1)+2.D0*Yat(2)+XeZM
      dY=(Pl*Ye)**tret2
      PSI=Cpsi*Dy*RTp
      P=CPRESS*(Pl*Ye)*dY+CRgas*(XYZA+Ye/(1.D0+0.4D0*PSI))*Pl*Tp
      PotInt=(0.5d0*Zf)*(Tpzf+Tpzb)
      Egas=1.5D0*P*RPl
      If(LST.NE.0)Then
      PPl=(5.D0*tret)*CPRESS*Ye*dY+CRgas*(XYZA+Ye/(1.D0+0.4D0*PSI))*Tp-CRgas*Ye/(1.D0+0.4D0*PSI)**2*(0.4D0*tret2)*PSI*Tp
      PT=CRgas*(XYZA+Ye/(1.D0+0.4D0*PSI))*Pl+CRgas*Ye/(1.D0+0.4D0*PSI)**2*0.4D0*PSI*Pl
      EPl=1.5D0*PPl-Egas
      ET=1.5D0*PT*RPl
      ZMT=0.D0
      ZMPl=0.D0
      YZMT=0.D0
      YZMPl=0.D0
      Endif
      Egas=Egas+CRgas*(YZ*PotInt+Psum(1,1)*Yat(1)+Psum(Nstage,2)*Yat(2))
      Xion(1,1)=1.D0
      DO09921i=2,Natom
      Xion(1,i)=0.D0
      Xion(2,i)=1.D0
09921 CONTINUE
      GOTO(09996,09995),I6R002
09924 CONTINUE
      RPl=1.d0/Pl
      RTp=1.d0/Tp
      Tpsqrt=Tp*sqrt(Tp)
      Barnum=Pl*CAvD
      Rnbar=RPl*(1.d0/CAvD)
      YZ=0.D0
      DO09918I=3,Natom
      YZ=YZ+Yat(i)
09918 CONTINUE
      XYZA=YZ+Yat(1)+Yat(2)
      IF(.NOT.(Pl.LE.DLOW))GOTO09915
      I6R001=1
      GOTO09999
09997 CONTINUE
      Psicap=0.d0
      GOTO09913
09915 CONTINUE
      IF(.NOT.(Pl.GE.DUP))GOTO09914
      I6R002=1
      GOTO09998
09996 CONTINUE
      Xe=Ye
      Psicap=Psi
      GOTO09913
09914 CONTINUE
      WW=CWW*LOG(Pl)-CLOW
      WD=CWW*RPl
      WP=WW**3*(4.D0-3.D0*WW)
      I6R002=2
      GOTO09998
09995 CONTINUE
      Pdeg=P
      Edeg=Egas
      IF(LST.NE.0)THEN
      PTdeg=PT
      ETdeg=ET
      PPldeg=PPl
      EPldeg=EPl
      ENDIF
      I6R001=2
      GOTO09999
09994 CONTINUE
      IF(LST.NE.0)THEN
      PT=PTdeg*WP+PT*(1.D0-WP)+(ETdeg-ET)*Pl**2*(12.D0*WW**2*(1.D0-WW)*WD)
      ET=ETdeg*WP+ET*(1.D0-WP)
      PPl=PPLdeg*WP+PPl*(1.D0-WP)+(Pdeg-P)*(12.D0*WW**2*(1.D0-WW)*WD)+(EPLdeg-EPl)*Pl*(12.D0*WW**2*(1.D0-WW)*WD)+(Edeg-Egas)*(Pl**2*
     *12.D0*WW*(2.D0-3.D0*WW)*WD**2-12.D0*CWW*WW**2*(1.D0-WW)+24.D0*Pl*WW**2*(1.D0-WW)*WD)
      EPl=EPLdeg*WP+EPl*(1.D0-WP)+(Edeg-Egas)*(Pl*12.D0*WW**2*(1.D0-WW)*WD)
      ZMPl=ZMPl*(1.D0-WP)+(zF-ZMEaN)*(Pl*12.D0*WW**2*(1.D0-WW)*WD)
      ZMT=ZMT*(1.D0-WP)
      YZMPl=YZMPl*(1.D0-WP)+(YZ-YZMEaN)*(Pl*12.D0*WW**2*(1.D0-WW)*WD)
      YZMT=YZMT*(1.D0-WP)
      ENDIF
      P=Pdeg*WP+P*(1.D0-WP)+(Edeg-Egas)*Pl**2*(12.D0*WW**2*(1.D0-WW)*WD)
      Egas=Edeg*WP+Egas*(1.D0-WP)
      Zmean=Zf*WP+Zmean*(1.D0-WP)
      YZmean=YZ*WP+YZmean*(1.D0-WP)
      Xe=Ye*WP+Xe*(1.D0-WP)
      Psicap=Psi*WP
09913 CONTINUE
      If(RadP)Then
      P=P+(RadC*Tp**4)*tret
      Egas=Egas+(RadC*Tp**4)*RPl
      If(LST.NE.0)Then
      PT=PT+4.D0*(RadC*Tp**3)*tret
      ET=ET+4.D0*(RadC*Tp**3)*RPl
      EPl=EPl-(RadC*Tp**4)*RPl
      Endif
      Endif
      If(LST.NE.0)Then
      DPE=(EPl+Tp*PT*RPl)*(Pl/P)-1.D0
      W=(PT/ET)*RPl
      GAM=(Pl*PPl+W*(Tp*PT))/P
      DA=W/GAM
      Endif
      RETURN
      END
