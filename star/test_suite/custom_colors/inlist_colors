! Enhanced MESA inlist for stellar evolution with synthetic photometry
! This inlist evolves a star from pre-main sequence through multiple evolutionary phases
! Uses the custom colors module to calculate synthetic magnitudes in multiple filters

! Niall Miller (2025)

! =============================================================================
! STAR_JOB NAMELIST - Controls model creation and global job settings
! =============================================================================
&star_job
      ! Model creation settings
      create_pre_main_sequence_model = .true.  ! Start from pre-MS rather than ZAMS
      
      ! Termination conditions
      ! required_termination_code_string = 'xa_central_lower_limit'  ! Stop when central H is depleted
      save_model_when_terminate = .false.
      !save_model_filename = 'custom_colors_end.mod'
      !required_termination_code_string = ''
      
      ! Custom output files
      history_columns_file = 'custom_colors_history_columns.list'  ! Additional history columns
      
      ! Verbosity and debugging
      show_log_description_at_start = .true.  ! Print detailed info at start
      
      ! Pre-MS model settings
      pre_ms_relax_to_start_radiative_core = .false.  ! Don't force radiative core formation

      pgstar_flag     = .true.
/

! =============================================================================
! EOS NAMELIST - Equation of state settings (using defaults)
! =============================================================================
&eos
/

! =============================================================================
! KAP NAMELIST - Opacity settings
! =============================================================================
&kap
      Zbase = 0.02d0               ! Base metallicity (Z) for opacity tables
      kap_file_prefix = 'gs98'     ! Use Grevesse & Sauval 1998 opacity tables
/



! =============================================================================
! COLORS NAMELIST - Synthetic photometry settings
! Custom colors and this project inlist by Niall Miller
! =============================================================================
&colors
      ! Enable the colors module
      use_colors = .true.
      
      ! Filter system specification
      ! This points to a directory containing filter transmission curves
      ! The GAIA directory should contain files like:
      ! - Gbp_bright.dat, Gbp.dat, Gbp_faint.dat (Blue photometer filters)
      ! - G.dat (White light photometer)  
      ! - Grp.dat (Red photometer)
      ! - Grvs.dat (Radial Velocity Spectrometer)
      instrument = '/colors/data/filters/Generic/Johnson'

      ! Stellar atmosphere model directory
      ! Should contain:
      ! - lookup_table.csv: mapping file with columns for filename, Teff, log_g, metallicity
      ! - Individual SED files: wavelength vs surface flux for each stellar model
      ! - flux_cube.bin: pre-computed interpolation grid (if using linear/hermite interpolation)
      stellar_atm = '/colors/data/stellar_models/Kurucz2003all/'
      
      ! Physical parameters for synthetic photometry
      distance = 3.0857d19         ! Distance to star in cm (1 pc = 3.0857e16 m for absolute mags)
      
      ! Output options
      colors_results_directory = 'SED'
      make_csv = .true.            ! Write detailed SED files showing filter convolution  -- This is also needed for plotting the SED.
                                   ! Creates files like: SED/G_SED.csv, SED/VEGA_G_SED.csv

      mag_system = 'Vega'

      ! Vega spectrum for zero-point calibration
      ! This file should contain wavelength (Å) and flux (erg/s/cm²/Å) columns
      ! Used to define the zero-point of the magnitude system (Vega = 0.0 mag)
      vega_sed = '/colors/data/stellar_models/vega_flam.csv'


/ ! end of colors namelist




! =============================================================================
! CONTROLS NAMELIST - Main stellar evolution parameters
! =============================================================================
&controls
      ! --- BASIC STELLAR PARAMETERS ---
      ! 7.0 Solar Masses creates a very distinct "Blue Loop" during He-burning
      ! This causes the star to swing from Red -> Blue -> Red rapidly.
      initial_mass = 7.0d0            
      
      ! Solar metallicity makes for redder Red Giants and clearer loops
      initial_z = 0.02d0              

      ! --- STOPPING CONDITIONS ---
      xa_central_lower_limit_species(1) = 'he4'
      xa_central_lower_limit(1) = 1d-2  

      ! Fail-safe max age (just in case)
      max_age = 1d10               

      ! --- OUTPUT CONTROL ---
      ! High resolution history for smooth light curves
      history_interval = 1         
      profile_interval = 50        
      
      ! --- NUMERICAL CONTROLS ---
      varcontrol_target = 1d-3
      mesh_delta_coeff = 0.5   
/



! =============================================================================
! PGSTAR NAMELIST - Real-time plotting settings
! =============================================================================

&pgstar
  pgstar_interval = 10

  ! Standard HR Diagram
  HR_win_flag = .true.
  HR_logT_min = 3.2
  HR_logT_max = 4.3
  HR_logL_min = -1.0
  HR_logL_max = 4.0

  ! G band light curve
  History_Track2_win_flag = .true.
  History_Track2_xname = 'star_age'
  History_Track2_yname = 'V'
  History_Track2_title = 'V Light Curve'
  History_Track2_xaxis_label = 'Age (yr)'
  History_Track2_yaxis_label = 'V mag'

/
