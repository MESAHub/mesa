&kap
 !  use_Type2_opacities = .false. ! if cutting out core.

/

&eos
/

&star_job

   save_model_when_terminate = .true.
   save_model_filename = 'final.mod'
   !required_termination_code_string = 'Successful test: evolved 100 days past first relax'

   load_saved_model = .true.
   load_model_filename = 'he_dep.mod'

   read_extra_star_job_inlist(1) = .true.
   extra_star_job_inlist_name(1) = 'inlist_ppisn'

   !change_initial_v_flag = .true.
   !new_v_flag = .true.

   change_v_flag = .true.
   new_v_flag = .false.

   change_u_flag = .true.
   new_u_flag = .true.

   relax_to_this_tau_factor = 1d-3!-1
   dlogtau_factor = 0.1d0
   relax_tau_factor = .false.

   
    ! if restarting from .mod file, need high initial dt for relaxing.
    set_initial_dt = .true.
    years_for_initial_dt = -1
    seconds_for_initial_dt = 1d7!-1

    set_initial_age = .true.
    initial_age = 0

    ! on first pass.
    remove_center_by_temperature = 5d6!5d6

/ !end of star_job namelist


&controls

   ! probably not necessary
   !remove_small_D_limit = 1d-16
   remove_mixing_glitches = .false.!.true. ! If true, then okay to remove gaps and singletons.
   mlt_make_surface_no_mixing = .true.
   make_mlt_hydrodynamic = .false.


   ! controls for analyzing pulsations
   x_integer_ctrl(1) = 500 ! gyre interval to check
  ! x_ctrl(1) = 0.158d-05 !1000d0 ! expected period (in days)

      x_integer_ctrl(3) = 0 ! mode l (e.g. 0 for p modes, 1 for g modes)
         ! should match gyre.in mode l 
      x_integer_ctrl(4) = 1 ! order
      x_ctrl(1) = 0.158d-05 ! freq ~ this (Hz)
      x_ctrl(2) = 0.33d+04 ! growth < this (days)

   x_logical_ctrl(7) = .true. ! doing pulses
   x_integer_ctrl(7) = 0 ! 3 ! which period to check (<= 0 means don't check any)
   x_ctrl(7) = 1000d0 ! expected period (in days) 
!   x_ctrl(8) = 1.0 ! min_deltaR_for_periods (Rsun)
   x_ctrl(9) = 1d0 ! KE_growth_avg_abs_frac_new ! for averaging growth rates across steps.
   x_ctrl(10) = 0.3 ! min_period_div_target


   ! new rsp style meshing, thanks to Bill P.
   RSP2_use_mass_interp_face_values = .true.
   RSP2_nz = 600
   RSP2_nz_outer = 200
   RSP2_T_anchor = 11d3
   RSP2_dq_1_factor = 1d0
   remesh_for_TDC_pulsations_log_core_zoning = .false. ! .false means do rsp style core

   ! old star meshing to achieve rsp style models.
   okay_to_remesh = .true. 

   ! control for excising core upon loading .mod file.
   x_logical_ctrl(25) = .false. ! set true to remove core
   x_ctrl(14) = 5d6 ! desired core temperature to make cut at 

   ! remeshing flag for if we are doing an envelope model or full stellar model.
   x_logical_ctrl(23) = .false. ! .true. = RSP remesh envelope model, .false. = full stellar model
   x_logical_ctrl(24) = .true. ! if true turn off remesh at the following model number
   x_ctrl(12) = 31620! model number to turn off remesh ( only if if okay_to_remesh = .true.)

   ! timestep	
   x_ctrl(13) = 31650! model number to drop timestep

   ! TDC Pulsation timestepping.
   x_ctrl(17) = 1d7 ! dt before pulse, seconds for relaxing mesh
   x_ctrl(18) = 2.5d4 ! After a pulse begins, limit the timestep to this (in seconds). 
 

! turn off burning and mixing, if evolving envelope model
   eps_nuc_factor = 0
   non_nuc_neu_factor = 0
   dxdt_nuc_factor = 0
   mix_factor = 0

! GYRE set starting velocities, kick!
! kick when true and not restarting.
   x_logical_ctrl(5) = .true. ! to turn on gyre kick
   x_ctrl(11) = 31700! kick model at this model number

   x_ctrl(4) = 0d0 ! fraction_1st_overtone (order 2)
   x_ctrl(5) = 0d0 ! fraction_2nd_overtone (order 3)
   x_ctrl(6) = 1d0 ! initial vsurf (kms)



   ! turn of wind during Pulsation
   use_other_wind = .false.

   ! can optionally use QHSE form of dp/dm or hydro form below.
   use_dPrad_dm_form_of_T_gradient_eqn = .false. ! if false use QHSE form.
   min_kap_for_dPrad_dm_eqn = 1d-5
 
! timesteps for saturation

   !dt_div_min_dr_div_cs_limit = 2d0
   dt_div_min_dr_div_cs_hard_limit = 100d0! i don't like hard limits ~ EbF
   min_abs_u_div_cs_for_dt_div_min_dr_div_cs_limit = 0.8d0
   
   ! have used these values to do run to saturation, but may not be necessary ~ Bill P.
   dt_div_min_dr_div_cs_limit = 10d0!10d0
   min_q_for_dt_div_min_dr_div_cs_limit = 0.5d0
   max_q_for_dt_div_min_dr_div_cs_limit = 1d0
   min_k_for_dt_div_min_dr_div_cs_limit = 1 
   min_abs_du_div_cs_for_dt_div_min_dr_div_cs_limit = 0.001d0

   ! artificial viscosity if necessary, only works for v_flag 
   use_Pvsc_art_visc = .true.
   Pvsc_cq = 4.0d0
   Pvsc_zsh = 0.1d0

   ! velocity time centering
   !steps_before_use_velocity_time_centering = 31700 ! no v centering when commented
   use_P_d_1_div_rho_form_of_work_when_time_centering_velocity = .true.
   
   include_P_in_velocity_time_centering = .true.
   P_theta_for_velocity_time_centering = 0.5d0

   include_L_in_velocity_time_centering = .true.
   L_theta_for_velocity_time_centering = 0.5d0

   set_rho_to_dm_div_dV = .false. ! doesn't apply to u_flag


   convergence_ignore_equL_residuals = .true. ! include T-gradient eqn in newton

   ! OUTER BC, if not atm, then see below.
   atm_T_tau_opacity = 'fixed'

   ! OUTER BC for TDC Pulsations
   use_RSP_L_eqn_outer_BC = .false.
   RSP2_Lsurf_factor = 0.5d0
   use_zero_Pgas_outer_BC = .false.

   ! for u_flag, can optionally use these.
   use_compression_outer_BC = .false.
   use_momentum_outer_BC = .false.

      ! Convection model
      MLT_option = 'TDC'
      mixing_length_alpha = 2.25d0
      alpha_TDC_DAMP = 1d0
      alpha_TDC_DAMPR = 0d0!1d0! 0d0 for mlt
      alpha_TDC_PtdVdt = 0d0!1d0!1d-2!1d-2!0d0
      steps_before_use_TDC = 0
      alpha_TDC_DAMPM = 0.1d0!0.25d0
      mlt_Pturb_factor = 0d0
      alt_scale_height_flag = .false. ! ignore eggleton 
      TDC_num_innermost_cells_forced_nonturbulent = 2

      alt_scale_height_flag = .false. ! ignore eggleton 

      TDC_use_density_form_for_eddy_viscosity = .false.

   ! controls for shock capturing, relaxed for pulsations
    max_abs_du_div_cs_for_convection = 1d-1 !0.03d0
    max_v_div_cs_for_convection = 1d2
    max_v_for_convection = 1d4

   x_logical_ctrl(22) = .true. ! flag for in inlist_pulses







! everything below is old and from testing.






   max_num_merge_cells = 2

   ! these two in combination are important
   !max_num_merge_surface_cells = 15 ! necessary for surface, 15 better for massive stars
   !min_surface_cell_dq = 1d-5!2d-6 ! 1d-6 might be safer.
   ! any higher and you risk touching the convective shell during a 
   ! pulsation cycle which will make the surface go haywire.



mesh_min_k_old_for_split = 15
min_dq = 1d-5
max_center_cell_dq = 1d-4! leave at default if including core
max_surface_cell_dq = 1d-4
use_other_mesh_functions = .true.


!mesh_delta_coeff_factor_smooth_iters = 3!20!50 ! 3
!remesh_max_allowed_logT = 5d0 ! global control, not good.
!T_function1_weight = 30!110
!P_function_weight = 5!50 ! need custom P function weight for logT < 4.5
!log_tau_function_weight = 10!100
!log_kap_function_weight = 10

!max_dq = 5d-2

!xa_function_species(1) = 'he4'
!xa_function_weight(1) = 0
!xa_function_param(1) = 1d-2

!mesh_min_dlnR = 1d-14!1d-9
!merge_if_dr_div_dRstar_too_small = .false.
!merge_if_dr_div_cs_too_small = .false.

! if split merge amr hydro
  ! restore_mesh_on_retry = .true.
  ! num_steps_to_hold_mesh_after_retry = 5
! if hydro use momentum bc?

    use_split_merge_amr = .false.
    split_merge_amr_okay_to_split_1 = .true.
    merge_amr_ignore_core_cells = .true.
    merge_amr_logT_for_ignore_core_cells = 6.3d0 !1d99
    split_amr_ignore_core_cells = .true.
    split_amr_logT_for_ignore_core_cells = 6.3d0 !1d99

   mesh_delta_coeff = 1d0!0.8d0 ! RECOMMENDED 0.8d0
   !! this one is turned on in run_star_extras
   ! true in pulses use_split_merge_amr = .false.
   split_merge_amr_log_zoning = .false.
   !split_merge_amr_logtau_zoning = .true.
   !split_merge_amr_flipped_hybrid_zoning = .true.
   !split_merge_amr_hybrid_zoning = .true.

    split_merge_amr_r_core_cm = 1d8
split_merge_amr_nz_r_core = 1000!10000


   split_merge_amr_nz_baseline = 1000!6000 ! RECOMMENDED 6000
   split_merge_amr_MaxLong = 1.25d0
   split_merge_amr_MaxShort = 2.5d0


!    equal_split_density_amr = .false.

! deprecated?    trace_split_merge_amr = .false.


   split_merge_amr_max_iters = 100 ! setting this too high will smear pulsations. must restrict?
   split_merge_amr_okay_to_split_nz = .false.
split_merge_amr_mesh_delta_coeff = 1.0!0.3

   merge_amr_ignore_surface_cells = .false.
    merge_amr_k_for_ignore_surface_cells = 20!1500!100

   merge_amr_max_abs_du_div_cs = 0.03d0!0.5d0!5d-1!3d-2!0.03!0.05d0
   merge_amr_du_div_cs_limit_only_for_compression = .true.
   split_merge_amr_avoid_repeated_remesh = .true.
   merge_amr_inhibit_at_jumps =.false. ! reduce udnersize ratio for large jumps


report_solver_progress = .true.
report_ierr = .true. ! if true, produce terminal output when have some internal error

/ ! end of controls namelist

&pgstar

         ! axis limits -- to override system default selections
         !HR_logT_min = 3.6 !-101d0 ! only used if /= -101d0
         !HR_logT_max = 3.75!-101d0 ! only used if /= -101d0
         !HR_logL_min = 3.85!-101d0 ! only used if /= -101d0
         !HR_logL_max = 3.6!-101d0 ! only used if /= -101d0

         HR_file_interval = 50 ! output when `mod(model_number,HR_file_interval)==0`

/ ! end of pgstar namelist
