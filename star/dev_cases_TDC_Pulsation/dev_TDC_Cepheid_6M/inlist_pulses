&kap
use_Type2_opacities = .false. ! if envelope model only
cubic_interpolation_in_X = .false.
cubic_interpolation_in_Z = .false.
/

&eos
/

&star_job

   save_model_when_terminate = .true.
   save_model_filename = 'final.mod'
   !required_termination_code_string = 'Successful test: evolve through 5 pulsation cycles.'

   load_saved_model = .true.
   load_model_filename = 'he_dep.mod'

   read_extra_star_job_inlist(1) = .true.
   extra_star_job_inlist_name(1) = 'inlist_common'

   change_v_flag = .true.
   new_v_flag = .true.

   change_u_flag = .true.
   new_u_flag = .false.



   relax_to_this_tau_factor = 1d-3!-1
   dlogtau_factor = 0.1d0
   relax_tau_factor = .true.

   set_initial_dt = .true.
   years_for_initial_dt = -1
   seconds_for_initial_dt = 1d7

   set_initial_cumulative_energy_error = .true.
   new_cumulative_energy_error = 0d0

   set_initial_age = .true.
   initial_age = 0

   set_initial_model_number = .true.
   initial_model_number = 0

! on first pass.
   remove_initial_center_by_temperature = 2d6
   remove_center_set_zero_v_center = .true. ! set center v = 0

/ !end of star_job namelist


&controls

   ! limit max model number as part of test suite.
   max_model_number = 3000

   ! controls for analyzing pulsations using GYRE in MESA
   x_integer_ctrl(1) = 1000 ! gyre interval to check

   x_logical_ctrl(7) = .true. ! doing pulses
   x_integer_ctrl(7) = -1 ! 3 ! which period to check (<= 0 means don't check any)
   x_ctrl(7) = 12d0 ! expected period (in days) 
   x_ctrl(8) = -1 ! min_deltaR_for_periods (Rsun)
   x_ctrl(9) = 1d0 ! KE_growth_avg_abs_frac_new ! for averaging growth rates across steps.
   x_ctrl(10) = 0.3 ! min_period_div_target


   ! new rsp style meshing, thanks to Bill P.
   x_logical_ctrl(23) = .true. ! .true. = Remesh for TDC 
   TDC_pulse_use_mass_interp_face_values = .true.
   TDC_pulse_nz = 150 
   TDC_pulse_nz_outer = 40 
   TDC_pulse_T_anchor = 11d3
   TDC_pulse_dq_1_factor = 2d0
   remesh_for_TDC_pulsations_log_core_zoning = .false. ! .false means do rsp style core

   okay_to_remesh = .false. ! freeze mesh after initial remesh.
   x_logical_ctrl(24) = .true. ! if true turn off remesh at the following model number
   x_ctrl(12) = 200! model number to turn off remesh ( only if if okay_to_remesh = .true.)

! GYRE set starting velocities, kick!
! kick when true and not restarting.
   x_logical_ctrl(5) = .true. ! to turn on gyre kick
   x_ctrl(11) = 200! kick model at this model number

   x_ctrl(4) = 0d0 ! fraction_1st_overtone (order 2)
   x_ctrl(5) = 0d0 ! fraction_2nd_overtone (order 3)
   x_ctrl(6) = 5d0 ! initial vsurf (kms)


! turn off burning and mixing, if evolving envelope model
   eps_nuc_factor = 0
   non_nuc_neu_factor = 0
   dxdt_nuc_factor = 0
   mix_factor = 0

   ! turn of wind during Pulsation
   use_other_wind = .false.

   ! can optionally use QHSE form of dp/dm or dprad/dm form below.
   use_dPrad_dm_form_of_T_gradient_eqn = .false. ! if false use QHSE form.
   min_kap_for_dPrad_dm_eqn = 1d-5

! timesteps for saturation
      
  ! TDC Pulsation timestepping.
   x_ctrl(13) = 100! model number to drop timestep
   x_ctrl(17) = 2d3 ! dt before pulse, seconds
   x_ctrl(18) = 2d3 ! After a pulse begins, limit the timestep to this (in seconds).

   ! have used these values to do run to saturation, but may not be necessary ~ Bill P.
   dt_div_min_dr_div_cs_limit = 4d0! set less than 1d0 in high L/M stars.
   dt_div_min_dr_div_cs_hard_limit = 100d0! i don't like hard limits ~ EbF
   min_abs_u_div_cs_for_dt_div_min_dr_div_cs_limit = 0.8d0
   min_q_for_dt_div_min_dr_div_cs_limit = 0d0
   max_q_for_dt_div_min_dr_div_cs_limit = 1d0
   min_k_for_dt_div_min_dr_div_cs_limit = 1 
   min_abs_du_div_cs_for_dt_div_min_dr_div_cs_limit = 0.001d0

   ! artificial viscosity if necessary, v_flag only
   use_Pvsc_art_visc = .true.
   Pvsc_cq = 4.0d0
   Pvsc_zsh = 0.1d0

   ! velocity time centering for v_flag only.
   steps_before_use_velocity_time_centering = 300 ! no v centering when commented
   use_P_d_1_div_rho_form_of_work_when_time_centering_velocity = .true.
   
   include_P_in_velocity_time_centering = .true. ! set to false for u_flag
   P_theta_for_velocity_time_centering = 0.5d0

   include_L_in_velocity_time_centering = .true.
   L_theta_for_velocity_time_centering = 0.5d0

   set_rho_to_dm_div_dV = .false. ! only applies to v_flag


   convergence_ignore_equL_residuals = .false. ! include T-gradient eqn in newton

! OUTER BC for TDC Pulsations
   use_RSP_L_eqn_outer_BC = .true.
   RSP2_Lsurf_factor = 0.5d0
   use_zero_Pgas_outer_BC = .true.
   use_compression_outer_BC = .false.
   use_momentum_outer_BC = .false. ! adopt this if not using rsp and zero P bc.

! Convection model
   MLT_option = 'TDC'
   include_mlt_corr_to_TDC = .false. ! true K. 1986 model, no mlt limiting
   TDC_include_eturb_in_energy_equation = .true.
   use_rsp_form_of_scale_height = .true.
   include_mlt_in_velocity_time_centering = .false.
   include_mlt_Pturb_in_thermodynamic_gradients = .false.
   mixing_length_alpha = 1.5d0
   alpha_TDC_DAMP = 1d0
   alpha_TDC_DAMPR = 0d0
   alpha_TDC_PtdVdt = 0d0
   alpha_TDC_DAMPM = 0.25d0
   steps_before_use_TDC = 0
   mlt_Pturb_factor = 0d0 ! use 3d0 = 1d0 in TDC. time lagged.
   alt_scale_height_flag = .false. ! ignore eggleton in the core.
   TDC_num_innermost_cells_forced_nonturbulent = 2 ! for envelope models only.


   ! dev feature, modify g -> geff (with hydro corr)
   make_mlt_hydrodynamic = .false.
   TDC_use_density_form_for_eddy_viscosity = .false. ! always true for u_flag.
   mlt_make_surface_no_mixing = .false.

! controls for shock capturing, relaxed for pulsations
   ! main purpose is to force radiative in shock face
    max_abs_du_div_cs_for_convection = 1d0 !1d-1 !0.03d0
    max_v_div_cs_for_convection = 1d2
    max_v_for_convection = 1d4

   x_logical_ctrl(22) = .true. ! flag for in inlist_pulses


! output
   log_directory = 'LOGS_pulsation'

! Debugging
   report_solver_progress = .false.
   report_ierr = .false. ! if true, produce terminal output when have some internal error

/ ! end of controls namelist

&pgstar

Grid1_file_dir = 'png_pulsation'


! axis limits -- to override system default selections
!HR_logT_min = 3.6 !-101d0 ! only used if /= -101d0
!HR_logT_max = 3.75!-101d0 ! only used if /= -101d0
!HR_logL_min = 3.85!-101d0 ! only used if /= -101d0
!HR_logL_max = 3.6!-101d0 ! only used if /= -101d0

HR_file_interval = 50 ! output when `mod(model_number,HR_file_interval)==0`

/ ! end of pgstar namelist
